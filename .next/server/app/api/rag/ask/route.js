"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/rag/ask/route";
exports.ids = ["app/api/rag/ask/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fask%2Froute&page=%2Fapi%2Frag%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fask%2Froute.ts&appDir=C%3A%5CpmkProject%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CpmkProject&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fask%2Froute&page=%2Fapi%2Frag%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fask%2Froute.ts&appDir=C%3A%5CpmkProject%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CpmkProject&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_pmkProject_src_app_api_rag_ask_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/rag/ask/route.ts */ \"(rsc)/./src/app/api/rag/ask/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/rag/ask/route\",\n        pathname: \"/api/rag/ask\",\n        filename: \"route\",\n        bundlePath: \"app/api/rag/ask/route\"\n    },\n    resolvedPagePath: \"C:\\\\pmkProject\\\\src\\\\app\\\\api\\\\rag\\\\ask\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_pmkProject_src_app_api_rag_ask_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/rag/ask/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyYWclMkZhc2slMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnJhZyUyRmFzayUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnJhZyUyRmFzayUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDcG1rUHJvamVjdCU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q3Bta1Byb2plY3QmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ0M7QUFDOUU7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wa20tcHJvamVjdC8/YTJmMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxwbWtQcm9qZWN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXHJhZ1xcXFxhc2tcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwic3RhbmRhbG9uZVwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9yYWcvYXNrL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcmFnL2Fza1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvcmFnL2Fzay9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXHBta1Byb2plY3RcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccmFnXFxcXGFza1xcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9yYWcvYXNrL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fask%2Froute&page=%2Fapi%2Frag%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fask%2Froute.ts&appDir=C%3A%5CpmkProject%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CpmkProject&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/rag/ask/route.ts":
/*!**************************************!*\
  !*** ./src/app/api/rag/ask/route.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _utils_langchain__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/utils/langchain */ \"(rsc)/./src/utils/langchain.ts\");\n\n\n/**\r\n * RAG 기반 질의응답 API\r\n * 사용자 질문을 받아 관련 컨텍스트를 검색하고 응답을 생성합니다.\r\n */ async function POST(request) {\n    try {\n        const body = await request.json().catch((e)=>{\n            console.error(\"요청 본문 파싱 실패:\", e);\n            return null;\n        });\n        if (!body || !body.query) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"질문이 필요합니다.\"\n            }, {\n                status: 400\n            });\n        }\n        const { query, similarity = 0.7, limit = 5 } = body;\n        console.log(`RAG 질의 처리: \"${query}\"`);\n        // RAG 응답 생성\n        try {\n            const response = await (0,_utils_langchain__WEBPACK_IMPORTED_MODULE_1__.generateRagResponse)(query, similarity, limit);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: true,\n                data: response\n            });\n        } catch (ragError) {\n            console.error(\"RAG 응답 생성 오류:\", ragError);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: ragError instanceof Error ? ragError.message : \"응답을 생성할 수 없습니다.\"\n            }, {\n                status: 422\n            });\n        }\n    } catch (error) {\n        console.error(\"질의 처리 오류:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: false,\n            error: error instanceof Error ? error.message : \"처리 중 오류가 발생했습니다.\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9yYWcvYXNrL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUEyQztBQUNhO0FBRXhEOzs7Q0FHQyxHQUNNLGVBQWVFLEtBQUtDLE9BQWdCO0lBQ3pDLElBQUk7UUFDRixNQUFNQyxPQUFPLE1BQU1ELFFBQVFFLElBQUksR0FBR0MsS0FBSyxDQUFDQyxDQUFBQTtZQUN0Q0MsUUFBUUMsS0FBSyxDQUFDLGdCQUFnQkY7WUFDOUIsT0FBTztRQUNUO1FBRUEsSUFBSSxDQUFDSCxRQUFRLENBQUNBLEtBQUtNLEtBQUssRUFBRTtZQUN4QixPQUFPVixrRkFBWUEsQ0FBQ0ssSUFBSSxDQUN0QjtnQkFBRU0sU0FBUztnQkFBT0YsT0FBTztZQUFhLEdBQ3RDO2dCQUFFRyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNLEVBQUVGLEtBQUssRUFBRUcsYUFBYSxHQUFHLEVBQUVDLFFBQVEsQ0FBQyxFQUFFLEdBQUdWO1FBQy9DSSxRQUFRTyxHQUFHLENBQUMsQ0FBQyxZQUFZLEVBQUVMLE1BQU0sQ0FBQyxDQUFDO1FBRW5DLFlBQVk7UUFDWixJQUFJO1lBQ0YsTUFBTU0sV0FBVyxNQUFNZixxRUFBbUJBLENBQUNTLE9BQU9HLFlBQVlDO1lBRTlELE9BQU9kLGtGQUFZQSxDQUFDSyxJQUFJLENBQUM7Z0JBQ3ZCTSxTQUFTO2dCQUNUTSxNQUFNRDtZQUNSO1FBQ0YsRUFBRSxPQUFPRSxVQUFVO1lBQ2pCVixRQUFRQyxLQUFLLENBQUMsaUJBQWlCUztZQUUvQixPQUFPbEIsa0ZBQVlBLENBQUNLLElBQUksQ0FDdEI7Z0JBQ0VNLFNBQVM7Z0JBQ1RGLE9BQU9TLG9CQUFvQkMsUUFBUUQsU0FBU0UsT0FBTyxHQUFHO1lBQ3hELEdBQ0E7Z0JBQUVSLFFBQVE7WUFBSTtRQUVsQjtJQUNGLEVBQUUsT0FBT0gsT0FBTztRQUNkRCxRQUFRQyxLQUFLLENBQUMsYUFBYUE7UUFFM0IsT0FBT1Qsa0ZBQVlBLENBQUNLLElBQUksQ0FDdEI7WUFDRU0sU0FBUztZQUNURixPQUFPQSxpQkFBaUJVLFFBQVFWLE1BQU1XLE9BQU8sR0FBRztRQUNsRCxHQUNBO1lBQUVSLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGttLXByb2plY3QvLi9zcmMvYXBwL2FwaS9yYWcvYXNrL3JvdXRlLnRzPzI4MGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBnZW5lcmF0ZVJhZ1Jlc3BvbnNlIH0gZnJvbSAnQC91dGlscy9sYW5nY2hhaW4nO1xyXG5cclxuLyoqXHJcbiAqIFJBRyDquLDrsJgg7KeI7J2Y7J2R64u1IEFQSVxyXG4gKiDsgqzsmqnsnpAg7KeI66y47J2EIOuwm+yVhCDqtIDroKgg7Luo7YWN7Iqk7Yq466W8IOqygOyDie2VmOqzoCDsnZHri7XsnYQg7IOd7ISx7ZWp64uI64ukLlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCk6IFByb21pc2U8UmVzcG9uc2U+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpLmNhdGNoKGUgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfsmpTssq0g67O466y4IO2MjOyLsSDsi6TtjKg6JywgZSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGlmICghYm9keSB8fCAhYm9keS5xdWVyeSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICfsp4jrrLjsnbQg7ZWE7JqU7ZWp64uI64ukLicgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgeyBxdWVyeSwgc2ltaWxhcml0eSA9IDAuNywgbGltaXQgPSA1IH0gPSBib2R5O1xyXG4gICAgY29uc29sZS5sb2coYFJBRyDsp4jsnZgg7LKY66asOiBcIiR7cXVlcnl9XCJgKTtcclxuICAgIFxyXG4gICAgLy8gUkFHIOydkeuLtSDsg53shLFcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2VuZXJhdGVSYWdSZXNwb25zZShxdWVyeSwgc2ltaWxhcml0eSwgbGltaXQpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IHJlc3BvbnNlXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAocmFnRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignUkFHIOydkeuLtSDsg53shLEg7Jik66WYOicsIHJhZ0Vycm9yKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IHJhZ0Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyByYWdFcnJvci5tZXNzYWdlIDogJ+ydkeuLteydhCDsg53shLHtlaAg7IiYIOyXhuyKteuLiOuLpC4nIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQyMiB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+yniOydmCDsspjrpqwg7Jik66WYOicsIGVycm9yKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAn7LKY66asIOykkSDsmKTrpZjqsIAg67Cc7IOd7ZaI7Iq164uI64ukLicgXHJcbiAgICAgIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImdlbmVyYXRlUmFnUmVzcG9uc2UiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwiY2F0Y2giLCJlIiwiY29uc29sZSIsImVycm9yIiwicXVlcnkiLCJzdWNjZXNzIiwic3RhdHVzIiwic2ltaWxhcml0eSIsImxpbWl0IiwibG9nIiwicmVzcG9uc2UiLCJkYXRhIiwicmFnRXJyb3IiLCJFcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/rag/ask/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase.ts":
/*!*****************************!*\
  !*** ./src/lib/supabase.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getClientSupabase: () => (/* binding */ getClientSupabase),\n/* harmony export */   getServerSupabase: () => (/* binding */ getServerSupabase),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   supabaseClient: () => (/* binding */ supabaseClient),\n/* harmony export */   testSupabaseConnection: () => (/* binding */ testSupabaseConnection)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Supabase Client\nconst supabaseUrl = \"https://ghtqqcoyakjozzhegktl.supabase.co\" || 0;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_KEY || \"\";\n// 서비스 키를 사용한 클라이언트 (백엔드 전용) - RLS 우회\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey);\n// 익명 키를 사용한 클라이언트 (프론트엔드 안전)\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdodHFxY295YWtqb=\\\"\\\"3p6aGVna3RsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NjA4NjkwMywiZXhwIjoyMDYxNjYyOTAzfQ.3Ygn7Ql9okDXtYnTblDXKLg2wXge1tHhm5Zok_N283k\" || 0;\nconst supabaseClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey);\n/**\r\n * 백엔드 API에서 사용할 Supabase 클라이언트 인스턴스를 반환합니다.\r\n * RLS 정책을 우회할 수 있는 서비스 키를 사용합니다.\r\n */ function getServerSupabase() {\n    return supabaseAdmin;\n}\n/**\r\n * 브라우저에서 사용할 Supabase 클라이언트 인스턴스를 반환합니다.\r\n * RLS 정책이 적용된 익명 키를 사용합니다.\r\n */ function getClientSupabase() {\n    return supabaseClient;\n}\n// Supabase 연결 테스트 함수\nasync function testSupabaseConnection() {\n    try {\n        // 환경 변수만 확인\n        if (!supabaseUrl) {\n            throw new Error(\"Supabase URL이 설정되지 않았습니다\");\n        }\n        if (!supabaseServiceKey) {\n            throw new Error(\"Supabase 서비스 키가 설정되지 않았습니다\");\n        }\n        if (!supabaseAnonKey) {\n            throw new Error(\"Supabase 익명 키가 설정되지 않았습니다\");\n        }\n        return {\n            success: true,\n            message: \"Supabase 환경 변수 확인 완료, 마이그레이션을 진행합니다.\"\n        };\n    } catch (error) {\n        console.error(\"Supabase 연결 테스트 오류:\", error);\n        return {\n            success: false,\n            message: error instanceof Error ? error.message : \"알 수 없는 오류\"\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFxRDtBQUVyRCxrQkFBa0I7QUFDbEIsTUFBTUMsY0FBY0MsMENBQW9DLElBQUk7QUFDNUQsTUFBTUcscUJBQXFCSCxRQUFRQyxHQUFHLENBQUNHLG9CQUFvQixJQUFJO0FBRS9ELHFDQUFxQztBQUM5QixNQUFNQyxnQkFBZ0JQLG1FQUFZQSxDQUFDQyxhQUFhSSxvQkFBb0I7QUFFM0UsNkJBQTZCO0FBQzdCLE1BQU1HLGtCQUFrQk4sa09BQXlDLElBQUk7QUFDOUQsTUFBTVEsaUJBQWlCVixtRUFBWUEsQ0FBQ0MsYUFBYU8saUJBQWlCO0FBRXpFOzs7Q0FHQyxHQUNNLFNBQVNHO0lBQ2QsT0FBT0o7QUFDVDtBQUVBOzs7Q0FHQyxHQUNNLFNBQVNLO0lBQ2QsT0FBT0Y7QUFDVDtBQUVBLHFCQUFxQjtBQUNkLGVBQWVHO0lBQ3BCLElBQUk7UUFDRixZQUFZO1FBQ1osSUFBSSxDQUFDWixhQUFhO1lBQ2hCLE1BQU0sSUFBSWEsTUFBTTtRQUNsQjtRQUVBLElBQUksQ0FBQ1Qsb0JBQW9CO1lBQ3ZCLE1BQU0sSUFBSVMsTUFBTTtRQUNsQjtRQUVBLElBQUksQ0FBQ04saUJBQWlCO1lBQ3BCLE1BQU0sSUFBSU0sTUFBTTtRQUNsQjtRQUVBLE9BQU87WUFDTEMsU0FBUztZQUNUQyxTQUFTO1FBQ1g7SUFDRixFQUFFLE9BQU9DLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLHVCQUF1QkE7UUFDckMsT0FBTztZQUNMRixTQUFTO1lBQ1RDLFNBQVNDLGlCQUFpQkgsUUFBUUcsTUFBTUQsT0FBTyxHQUFHO1FBQ3BEO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3BrbS1wcm9qZWN0Ly4vc3JjL2xpYi9zdXBhYmFzZS50cz8wNmUxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XHJcblxyXG4vLyBTdXBhYmFzZSBDbGllbnRcclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgJyc7XHJcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfS0VZIHx8ICcnO1xyXG5cclxuLy8g7ISc67mE7IqkIO2CpOulvCDsgqzsmqntlZwg7YG065287J207Ja47Yq4ICjrsLHsl5Trk5wg7KCE7JqpKSAtIFJMUyDsmrDtmoxcclxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSk7XHJcblxyXG4vLyDsnbXrqoUg7YKk66W8IOyCrOyaqe2VnCDtgbTrnbzsnbTslrjtirggKO2UhOuhoO2KuOyXlOuTnCDslYjsoIQpXHJcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8ICcnO1xyXG5leHBvcnQgY29uc3Qgc3VwYWJhc2VDbGllbnQgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XHJcblxyXG4vKipcclxuICog67Cx7JeU65OcIEFQSeyXkOyEnCDsgqzsmqntlaAgU3VwYWJhc2Ug7YG065287J207Ja47Yq4IOyduOyKpO2EtOyKpOulvCDrsJjtmZjtlanri4jri6QuXHJcbiAqIFJMUyDsoJXssYXsnYQg7Jqw7ZqM7ZWgIOyImCDsnojripQg7ISc67mE7IqkIO2CpOulvCDsgqzsmqntlanri4jri6QuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VydmVyU3VwYWJhc2UoKSB7XHJcbiAgcmV0dXJuIHN1cGFiYXNlQWRtaW47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDruIzrnbzsmrDsoIDsl5DshJwg7IKs7Jqp7ZWgIFN1cGFiYXNlIO2BtOudvOydtOyWuO2KuCDsnbjsiqTthLTsiqTrpbwg67CY7ZmY7ZWp64uI64ukLlxyXG4gKiBSTFMg7KCV7LGF7J20IOyggeyaqeuQnCDsnbXrqoUg7YKk66W8IOyCrOyaqe2VqeuLiOuLpC5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDbGllbnRTdXBhYmFzZSgpIHtcclxuICByZXR1cm4gc3VwYWJhc2VDbGllbnQ7XHJcbn1cclxuXHJcbi8vIFN1cGFiYXNlIOyXsOqysCDthYzsiqTtirgg7ZWo7IiYXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0ZXN0U3VwYWJhc2VDb25uZWN0aW9uKCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyDtmZjqsr0g67OA7IiY66eMIO2ZleyduFxyXG4gICAgaWYgKCFzdXBhYmFzZVVybCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIFVSTOydtCDshKTsoJXrkJjsp4Ag7JWK7JWY7Iq164uI64ukJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICghc3VwYWJhc2VTZXJ2aWNlS2V5KSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2Ug7ISc67mE7IqkIO2CpOqwgCDshKTsoJXrkJjsp4Ag7JWK7JWY7Iq164uI64ukJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICghc3VwYWJhc2VBbm9uS2V5KSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2Ug7J2166qFIO2CpOqwgCDshKTsoJXrkJjsp4Ag7JWK7JWY7Iq164uI64ukJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7IFxyXG4gICAgICBzdWNjZXNzOiB0cnVlLCBcclxuICAgICAgbWVzc2FnZTogJ1N1cGFiYXNlIO2ZmOqyvSDrs4DsiJgg7ZmV7J24IOyZhOujjCwg66eI7J206re466CI7J207IWY7J2EIOynhO2Wie2VqeuLiOuLpC4nIFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignU3VwYWJhc2Ug7Jew6rKwIO2FjOyKpO2KuCDsmKTrpZg6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgXHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAn7JWMIOyImCDsl4bripQg7Jik66WYJyBcclxuICAgIH07XHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX0tFWSIsInN1cGFiYXNlQWRtaW4iLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsInN1cGFiYXNlQ2xpZW50IiwiZ2V0U2VydmVyU3VwYWJhc2UiLCJnZXRDbGllbnRTdXBhYmFzZSIsInRlc3RTdXBhYmFzZUNvbm5lY3Rpb24iLCJFcnJvciIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiZXJyb3IiLCJjb25zb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase.ts\n");

/***/ }),

/***/ "(rsc)/./src/utils/embeddings.ts":
/*!*********************************!*\
  !*** ./src/utils/embeddings.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chunkMessages: () => (/* binding */ chunkMessages),\n/* harmony export */   getEmbedding: () => (/* binding */ getEmbedding),\n/* harmony export */   truncateText: () => (/* binding */ truncateText)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var gpt_tokenizer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! gpt-tokenizer */ \"(rsc)/./node_modules/gpt-tokenizer/esm/main.js\");\n\n\n// OpenAI API 클라이언트 초기화\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n/**\r\n * 텍스트에서 유효하지 않은 문자를 제거합니다.\r\n * 특히 \\u0000(NULL) 문자와 기타 PostgreSQL에서 문제를 일으킬 수 있는 문자를 제거합니다.\r\n */ function sanitizeText(text) {\n    if (!text) return \"\";\n    // null 문자 및 제어 문자 제거\n    let sanitized = text.replace(/[\\u0000-\\u001F\\u007F-\\u009F]/g, \" \");\n    // PostgreSQL에서 문제가 될 수 있는 특수 이스케이프 시퀀스 처리\n    sanitized = sanitized.replace(/\\\\u0000/g, \"\");\n    // 연속된 공백 제거\n    sanitized = sanitized.replace(/\\s+/g, \" \");\n    return sanitized.trim();\n}\n/**\r\n * 텍스트에 대한 임베딩 벡터를 생성합니다.\r\n * @param text 임베딩할 텍스트\r\n * @returns 임베딩 벡터\r\n */ async function getEmbedding(text) {\n    try {\n        // 텍스트 정제\n        const sanitizedText = sanitizeText(text);\n        if (!sanitizedText) {\n            console.warn(\"임베딩 생성을 위한 텍스트가 비어있습니다.\");\n            // 빈 텍스트의 경우 기본 임베딩 값 반환 (모두 0)\n            return Array(1536).fill(0);\n        }\n        // 텍스트가 너무 짧은 경우 (1-2글자) 처리\n        if (sanitizedText.length < 3) {\n            console.warn(`임베딩 생성을 위한 텍스트가 너무 짧습니다: \"${sanitizedText}\"`);\n            // 짧은 텍스트 확장 (의미를 유지하면서 컨텍스트 추가)\n            const expandedText = `질문: ${sanitizedText} 에 대한 정보를 찾습니다.`;\n            console.log(`확장된 텍스트로 임베딩 생성: \"${expandedText}\"`);\n            const response = await openai.embeddings.create({\n                model: \"text-embedding-3-small\",\n                input: expandedText\n            });\n            return response.data[0].embedding;\n        }\n        // 일반적인 경우 임베딩 생성\n        const response = await openai.embeddings.create({\n            model: \"text-embedding-3-small\",\n            input: sanitizedText\n        });\n        return response.data[0].embedding;\n    } catch (error) {\n        console.error(\"임베딩 생성 중 오류:\", error);\n        // 오류 발생 시 재시도 (다른 모델 사용)\n        try {\n            console.log(\"대체 임베딩 모델로 재시도합니다.\");\n            const response = await openai.embeddings.create({\n                model: \"text-embedding-ada-002\",\n                input: sanitizeText(text) || \"빈 쿼리\"\n            });\n            return response.data[0].embedding;\n        } catch (retryError) {\n            console.error(\"대체 임베딩 생성 중 오류:\", retryError);\n            // 모든 시도 실패 시 기본 임베딩 반환\n            return Array(1536).fill(0);\n        }\n    }\n}\n/**\r\n * 토큰 제한에 맞게 텍스트를 자릅니다.\r\n * @param text 원본 텍스트\r\n * @param maxTokens 최대 토큰 수 (기본값 8000)\r\n * @returns 잘린 텍스트\r\n */ function truncateText(text, maxTokens = 8000) {\n    const tokens = (0,gpt_tokenizer__WEBPACK_IMPORTED_MODULE_0__.encode)(text);\n    if (tokens.length <= maxTokens) {\n        return text;\n    }\n    // 수정된 부분\n    const truncatedTokens = tokens.slice(0, maxTokens);\n    return (0,gpt_tokenizer__WEBPACK_IMPORTED_MODULE_0__.decode)(truncatedTokens); // 잘못된 직접 구현 함수가 아니라 공식 함수 사용\n}\n/**\r\n * 대화 메시지를 청크로 분할합니다.\r\n * @param messages 메시지 배열\r\n * @param maxTokensPerChunk 청크당 최대 토큰 수 (기본값 500)\r\n * @returns 청크 배열\r\n */ function chunkMessages(messages, maxTokensPerChunk = 500) {\n    const chunks = [];\n    let currentChunk = \"\";\n    let currentTokens = 0;\n    let chunkIndex = 0;\n    for(let i = 0; i < messages.length; i++){\n        const message = messages[i];\n        const messageText = `[${message.role}]: ${message.content}`;\n        const messageTokens = (0,gpt_tokenizer__WEBPACK_IMPORTED_MODULE_0__.encode)(messageText).length;\n        // 단일 메시지가 청크 제한을 초과하는 경우 (분할 필요)\n        if (messageTokens > maxTokensPerChunk) {\n            // 현재 축적된 청크가 있다면 먼저 저장\n            if (currentTokens > 0) {\n                chunks.push({\n                    content: currentChunk.trim(),\n                    chunk_index: chunkIndex++\n                });\n                currentChunk = \"\";\n                currentTokens = 0;\n            }\n            // 긴 메시지를 여러 청크로 분할\n            const tokens = (0,gpt_tokenizer__WEBPACK_IMPORTED_MODULE_0__.encode)(messageText);\n            for(let j = 0; j < tokens.length; j += maxTokensPerChunk){\n                const chunkTokens = tokens.slice(j, j + maxTokensPerChunk);\n                chunks.push({\n                    content: (0,gpt_tokenizer__WEBPACK_IMPORTED_MODULE_0__.decode)(chunkTokens).trim(),\n                    chunk_index: chunkIndex++\n                });\n            }\n        } else if (currentTokens + messageTokens <= maxTokensPerChunk) {\n            currentChunk += (currentChunk ? \"\\n\\n\" : \"\") + messageText;\n            currentTokens += messageTokens;\n        } else {\n            chunks.push({\n                content: currentChunk.trim(),\n                chunk_index: chunkIndex++\n            });\n            currentChunk = messageText;\n            currentTokens = messageTokens;\n        }\n    }\n    // 마지막 청크 추가\n    if (currentTokens > 0) {\n        chunks.push({\n            content: currentChunk.trim(),\n            chunk_index: chunkIndex\n        });\n    }\n    return chunks;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VSxJQUFJLENBQUM7WUFDVkYsU0FBU1AsYUFBYTVCLElBQUk7WUFDMUJzQyxhQUFhUjtRQUNmO0lBQ0Y7SUFFQSxPQUFPSDtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGttLXByb2plY3QvLi9zcmMvdXRpbHMvZW1iZWRkaW5ncy50cz8zNmIwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPcGVuQUkgZnJvbSAnb3BlbmFpJztcclxuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UgfSBmcm9tICdAL3R5cGVzJztcclxuaW1wb3J0IHsgZW5jb2RlLCBkZWNvZGUgfSBmcm9tICdncHQtdG9rZW5pemVyJztcclxuXHJcbi8vIE9wZW5BSSBBUEkg7YG065287J207Ja47Yq4IOy0iOq4sO2ZlFxyXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcclxuICBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLFxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiDthY3siqTtirjsl5DshJwg7Jyg7Zqo7ZWY7KeAIOyViuydgCDrrLjsnpDrpbwg7KCc6rGw7ZWp64uI64ukLlxyXG4gKiDtirntnoggXFx1MDAwMChOVUxMKSDrrLjsnpDsmYAg6riw7YOAIFBvc3RncmVTUUzsl5DshJwg66y47KCc66W8IOydvOycvO2CrCDsiJgg7J6I64qUIOusuOyekOulvCDsoJzqsbDtlanri4jri6QuXHJcbiAqL1xyXG5mdW5jdGlvbiBzYW5pdGl6ZVRleHQodGV4dDogc3RyaW5nKTogc3RyaW5nIHtcclxuICBpZiAoIXRleHQpIHJldHVybiAnJztcclxuICBcclxuICAvLyBudWxsIOusuOyekCDrsI8g7KCc7Ja0IOusuOyekCDsoJzqsbBcclxuICBsZXQgc2FuaXRpemVkID0gdGV4dC5yZXBsYWNlKC9bXFx1MDAwMC1cXHUwMDFGXFx1MDA3Ri1cXHUwMDlGXS9nLCAnICcpO1xyXG4gIFxyXG4gIC8vIFBvc3RncmVTUUzsl5DshJwg66y47KCc6rCAIOuQoCDsiJgg7J6I64qUIO2KueyImCDsnbTsiqTsvIDsnbTtlIQg7Iuc7YCA7IqkIOyymOumrFxyXG4gIHNhbml0aXplZCA9IHNhbml0aXplZC5yZXBsYWNlKC9cXFxcdTAwMDAvZywgJycpO1xyXG4gIFxyXG4gIC8vIOyXsOyGjeuQnCDqs7XrsLEg7KCc6rGwXHJcbiAgc2FuaXRpemVkID0gc2FuaXRpemVkLnJlcGxhY2UoL1xccysvZywgJyAnKTtcclxuICBcclxuICByZXR1cm4gc2FuaXRpemVkLnRyaW0oKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIO2FjeyKpO2KuOyXkCDrjIDtlZwg7J6E67Kg65SpIOuyoe2EsOulvCDsg53shLHtlanri4jri6QuXHJcbiAqIEBwYXJhbSB0ZXh0IOyehOuyoOuUqe2VoCDthY3siqTtirhcclxuICogQHJldHVybnMg7J6E67Kg65SpIOuyoe2EsFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEVtYmVkZGluZyh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdPiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIO2FjeyKpO2KuCDsoJXsoJxcclxuICAgIGNvbnN0IHNhbml0aXplZFRleHQgPSBzYW5pdGl6ZVRleHQodGV4dCk7XHJcbiAgICBcclxuICAgIGlmICghc2FuaXRpemVkVGV4dCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ+yehOuyoOuUqSDsg53shLHsnYQg7JyE7ZWcIO2FjeyKpO2KuOqwgCDruYTslrTsnojsirXri4jri6QuJyk7XHJcbiAgICAgIC8vIOu5iCDthY3siqTtirjsnZgg6rK97JqwIOq4sOuzuCDsnoTrsqDrlKkg6rCSIOuwmO2ZmCAo66qo65GQIDApXHJcbiAgICAgIHJldHVybiBBcnJheSgxNTM2KS5maWxsKDApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDthY3siqTtirjqsIAg64SI66y0IOynp+ydgCDqsr3smrAgKDEtMuq4gOyekCkg7LKY66asXHJcbiAgICBpZiAoc2FuaXRpemVkVGV4dC5sZW5ndGggPCAzKSB7XHJcbiAgICAgIGNvbnNvbGUud2Fybihg7J6E67Kg65SpIOyDneyEseydhCDsnITtlZwg7YWN7Iqk7Yq46rCAIOuEiOustCDsp6fsirXri4jri6Q6IFwiJHtzYW5pdGl6ZWRUZXh0fVwiYCk7XHJcbiAgICAgIC8vIOynp+ydgCDthY3siqTtirgg7ZmV7J6lICjsnZjrr7jrpbwg7Jyg7KeA7ZWY66m07IScIOy7qO2FjeyKpO2KuCDstpTqsIApXHJcbiAgICAgIGNvbnN0IGV4cGFuZGVkVGV4dCA9IGDsp4jrrLg6ICR7c2FuaXRpemVkVGV4dH0g7JeQIOuMgO2VnCDsoJXrs7Trpbwg7LC+7Iq164uI64ukLmA7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDtmZXsnqXrkJwg7YWN7Iqk7Yq466GcIOyehOuyoOuUqSDsg53shLE6IFwiJHtleHBhbmRlZFRleHR9XCJgKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmVtYmVkZGluZ3MuY3JlYXRlKHtcclxuICAgICAgICBtb2RlbDogJ3RleHQtZW1iZWRkaW5nLTMtc21hbGwnLFxyXG4gICAgICAgIGlucHV0OiBleHBhbmRlZFRleHQsXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGFbMF0uZW1iZWRkaW5nO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDsnbzrsJjsoIHsnbgg6rK97JqwIOyehOuyoOuUqSDsg53shLFcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmVtYmVkZGluZ3MuY3JlYXRlKHtcclxuICAgICAgbW9kZWw6ICd0ZXh0LWVtYmVkZGluZy0zLXNtYWxsJyxcclxuICAgICAgaW5wdXQ6IHNhbml0aXplZFRleHQsXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlc3BvbnNlLmRhdGFbMF0uZW1iZWRkaW5nO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfsnoTrsqDrlKkg7IOd7ISxIOykkSDsmKTrpZg6JywgZXJyb3IpO1xyXG4gICAgXHJcbiAgICAvLyDsmKTrpZgg67Cc7IOdIOyLnCDsnqzsi5zrj4QgKOuLpOuluCDrqqjrjbgg7IKs7JqpKVxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coJ+uMgOyytCDsnoTrsqDrlKkg66qo642466GcIOyerOyLnOuPhO2VqeuLiOuLpC4nKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBvcGVuYWkuZW1iZWRkaW5ncy5jcmVhdGUoe1xyXG4gICAgICAgIG1vZGVsOiAndGV4dC1lbWJlZGRpbmctYWRhLTAwMicsIC8vIOuMgOyytCDrqqjrjbhcclxuICAgICAgICBpbnB1dDogc2FuaXRpemVUZXh0KHRleHQpIHx8ICfruYgg7L+866asJyxcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YVswXS5lbWJlZGRpbmc7XHJcbiAgICB9IGNhdGNoIChyZXRyeUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+uMgOyytCDsnoTrsqDrlKkg7IOd7ISxIOykkSDsmKTrpZg6JywgcmV0cnlFcnJvcik7XHJcbiAgICAgIC8vIOuqqOuToCDsi5zrj4Qg7Iuk7YyoIOyLnCDquLDrs7gg7J6E67Kg65SpIOuwmO2ZmFxyXG4gICAgICByZXR1cm4gQXJyYXkoMTUzNikuZmlsbCgwKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDthqDtgbAg7KCc7ZWc7JeQIOunnuqyjCDthY3siqTtirjrpbwg7J6Q66aF64uI64ukLlxyXG4gKiBAcGFyYW0gdGV4dCDsm5Drs7gg7YWN7Iqk7Yq4XHJcbiAqIEBwYXJhbSBtYXhUb2tlbnMg7LWc64yAIO2GoO2BsCDsiJggKOq4sOuzuOqwkiA4MDAwKVxyXG4gKiBAcmV0dXJucyDsnpjrprAg7YWN7Iqk7Yq4XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdHJ1bmNhdGVUZXh0KHRleHQ6IHN0cmluZywgbWF4VG9rZW5zOiBudW1iZXIgPSA4MDAwKTogc3RyaW5nIHtcclxuICBjb25zdCB0b2tlbnMgPSBlbmNvZGUodGV4dCk7XHJcbiAgXHJcbiAgaWYgKHRva2Vucy5sZW5ndGggPD0gbWF4VG9rZW5zKSB7XHJcbiAgICByZXR1cm4gdGV4dDtcclxuICB9XHJcbiAgXHJcbiAgLy8g7IiY7KCV65CcIOu2gOu2hFxyXG5jb25zdCB0cnVuY2F0ZWRUb2tlbnMgPSB0b2tlbnMuc2xpY2UoMCwgbWF4VG9rZW5zKTtcclxucmV0dXJuIGRlY29kZSh0cnVuY2F0ZWRUb2tlbnMpOyAvLyDsnpjrqrvrkJwg7KeB7KCRIOq1rO2YhCDtlajsiJjqsIAg7JWE64uI6528IOqzteyLnSDtlajsiJgg7IKs7JqpXHJcbn1cclxuXHJcbi8qKlxyXG4gKiDrjIDtmZQg66mU7Iuc7KeA66W8IOyyre2BrOuhnCDrtoTtlaDtlanri4jri6QuXHJcbiAqIEBwYXJhbSBtZXNzYWdlcyDrqZTsi5zsp4Ag67Cw7Je0XHJcbiAqIEBwYXJhbSBtYXhUb2tlbnNQZXJDaHVuayDssq3tgazri7kg7LWc64yAIO2GoO2BsCDsiJggKOq4sOuzuOqwkiA1MDApXHJcbiAqIEByZXR1cm5zIOyyre2BrCDrsLDsl7RcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjaHVua01lc3NhZ2VzKFxyXG4gIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdLCBcclxuICBtYXhUb2tlbnNQZXJDaHVuazogbnVtYmVyID0gNTAwXHJcbik6IHtjb250ZW50OiBzdHJpbmc7IGNodW5rX2luZGV4OiBudW1iZXJ9W10ge1xyXG4gIGNvbnN0IGNodW5rczoge2NvbnRlbnQ6IHN0cmluZzsgY2h1bmtfaW5kZXg6IG51bWJlcn1bXSA9IFtdO1xyXG4gIGxldCBjdXJyZW50Q2h1bmsgPSAnJztcclxuICBsZXQgY3VycmVudFRva2VucyA9IDA7XHJcbiAgbGV0IGNodW5rSW5kZXggPSAwO1xyXG4gIFxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbWVzc2FnZXMubGVuZ3RoOyBpKyspIHtcclxuICAgIGNvbnN0IG1lc3NhZ2UgPSBtZXNzYWdlc1tpXTtcclxuICAgIGNvbnN0IG1lc3NhZ2VUZXh0ID0gYFske21lc3NhZ2Uucm9sZX1dOiAke21lc3NhZ2UuY29udGVudH1gO1xyXG4gICAgY29uc3QgbWVzc2FnZVRva2VucyA9IGVuY29kZShtZXNzYWdlVGV4dCkubGVuZ3RoO1xyXG4gICAgXHJcbiAgICAvLyDri6jsnbwg66mU7Iuc7KeA6rCAIOyyre2BrCDsoJztlZzsnYQg7LSI6rO87ZWY64qUIOqyveyasCAo67aE7ZWgIO2VhOyalClcclxuICAgIGlmIChtZXNzYWdlVG9rZW5zID4gbWF4VG9rZW5zUGVyQ2h1bmspIHtcclxuICAgICAgLy8g7ZiE7J6sIOy2leyggeuQnCDssq3tgazqsIAg7J6I64uk66m0IOuovOyggCDsoIDsnqVcclxuICAgICAgaWYgKGN1cnJlbnRUb2tlbnMgPiAwKSB7XHJcbiAgICAgICAgY2h1bmtzLnB1c2goe1xyXG4gICAgICAgICAgY29udGVudDogY3VycmVudENodW5rLnRyaW0oKSxcclxuICAgICAgICAgIGNodW5rX2luZGV4OiBjaHVua0luZGV4KytcclxuICAgICAgICB9KTtcclxuICAgICAgICBjdXJyZW50Q2h1bmsgPSAnJztcclxuICAgICAgICBjdXJyZW50VG9rZW5zID0gMDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8g6ri0IOuplOyLnOyngOulvCDsl6zrn6wg7LKt7YGs66GcIOu2hO2VoFxyXG4gICAgICBjb25zdCB0b2tlbnMgPSBlbmNvZGUobWVzc2FnZVRleHQpO1xyXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRva2Vucy5sZW5ndGg7IGogKz0gbWF4VG9rZW5zUGVyQ2h1bmspIHtcclxuICAgICAgICBjb25zdCBjaHVua1Rva2VucyA9IHRva2Vucy5zbGljZShqLCBqICsgbWF4VG9rZW5zUGVyQ2h1bmspO1xyXG4gICAgICAgIGNodW5rcy5wdXNoKHtcclxuICAgICAgICAgIGNvbnRlbnQ6IGRlY29kZShjaHVua1Rva2VucykudHJpbSgpLCAvLyDqs7Xsi50gZGVjb2RlIOyCrOyaqVxyXG4gICAgICAgICAgY2h1bmtfaW5kZXg6IGNodW5rSW5kZXgrK1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9IFxyXG4gICAgLy8g7ZiE7J6sIOyyre2BrOyXkCDrqZTsi5zsp4Drpbwg7LaU6rCA7ZWgIOyImCDsnojripTsp4Ag7ZmV7J24XHJcbiAgICBlbHNlIGlmIChjdXJyZW50VG9rZW5zICsgbWVzc2FnZVRva2VucyA8PSBtYXhUb2tlbnNQZXJDaHVuaykge1xyXG4gICAgICBjdXJyZW50Q2h1bmsgKz0gKGN1cnJlbnRDaHVuayA/ICdcXG5cXG4nIDogJycpICsgbWVzc2FnZVRleHQ7XHJcbiAgICAgIGN1cnJlbnRUb2tlbnMgKz0gbWVzc2FnZVRva2VucztcclxuICAgIH0gXHJcbiAgICAvLyDsg4gg7LKt7YGsIOyLnOyekVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNodW5rcy5wdXNoKHtcclxuICAgICAgICBjb250ZW50OiBjdXJyZW50Q2h1bmsudHJpbSgpLFxyXG4gICAgICAgIGNodW5rX2luZGV4OiBjaHVua0luZGV4KytcclxuICAgICAgfSk7XHJcbiAgICAgIGN1cnJlbnRDaHVuayA9IG1lc3NhZ2VUZXh0O1xyXG4gICAgICBjdXJyZW50VG9rZW5zID0gbWVzc2FnZVRva2VucztcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgLy8g66eI7KeA66eJIOyyre2BrCDstpTqsIBcclxuICBpZiAoY3VycmVudFRva2VucyA+IDApIHtcclxuICAgIGNodW5rcy5wdXNoKHtcclxuICAgICAgY29udGVudDogY3VycmVudENodW5rLnRyaW0oKSxcclxuICAgICAgY2h1bmtfaW5kZXg6IGNodW5rSW5kZXhcclxuICAgIH0pO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gY2h1bmtzO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJPcGVuQUkiLCJlbmNvZGUiLCJkZWNvZGUiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJzYW5pdGl6ZVRleHQiLCJ0ZXh0Iiwic2FuaXRpemVkIiwicmVwbGFjZSIsInRyaW0iLCJnZXRFbWJlZGRpbmciLCJzYW5pdGl6ZWRUZXh0IiwiY29uc29sZSIsIndhcm4iLCJBcnJheSIsImZpbGwiLCJsZW5ndGgiLCJleHBhbmRlZFRleHQiLCJsb2ciLCJyZXNwb25zZSIsImVtYmVkZGluZ3MiLCJjcmVhdGUiLCJtb2RlbCIsImlucHV0IiwiZGF0YSIsImVtYmVkZGluZyIsImVycm9yIiwicmV0cnlFcnJvciIsInRydW5jYXRlVGV4dCIsIm1heFRva2VucyIsInRva2VucyIsInRydW5jYXRlZFRva2VucyIsInNsaWNlIiwiY2h1bmtNZXNzYWdlcyIsIm1lc3NhZ2VzIiwibWF4VG9rZW5zUGVyQ2h1bmsiLCJjaHVua3MiLCJjdXJyZW50Q2h1bmsiLCJjdXJyZW50VG9rZW5zIiwiY2h1bmtJbmRleCIsImkiLCJtZXNzYWdlIiwibWVzc2FnZVRleHQiLCJyb2xlIiwiY29udGVudCIsIm1lc3NhZ2VUb2tlbnMiLCJwdXNoIiwiY2h1bmtfaW5kZXgiLCJqIiwiY2h1bmtUb2tlbnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/utils/embeddings.ts\n");

/***/ }),

/***/ "(rsc)/./src/utils/langchain.ts":
/*!********************************!*\
  !*** ./src/utils/langchain.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateRagResponse: () => (/* binding */ generateRagResponse)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var _supabaseHandler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabaseHandler */ \"(rsc)/./src/utils/supabaseHandler.ts\");\n\n\n// OpenAI API 클라이언트 초기화\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_1__.OpenAI({\n    apiKey: process.env.OPENAI_API_KEY\n});\n/**\r\n * 질문에 대한 RAG 기반 응답을 생성합니다.\r\n * @param query 사용자 질문\r\n * @param similarity 유사도 임계값 (0.0 ~ 1.0)\r\n * @param limit 검색할 최대 청크 수\r\n * @returns 응답 객체\r\n */ async function generateRagResponse(query, similarity = 0.3, limit = 10) {\n    try {\n        console.log(`RAG 검색 시작 - 쿼리: \"${query}\", 유사도 임계값: ${similarity}, 제한: ${limit}`);\n        // 1. 유사한 청크 검색\n        const similarChunks = await (0,_supabaseHandler__WEBPACK_IMPORTED_MODULE_0__.searchSimilarChunks)(query, similarity, limit);\n        console.log(`검색된 청크 수: ${similarChunks?.length || 0}`);\n        if (!similarChunks || similarChunks.length === 0) {\n            console.log(\"관련 청크를 찾을 수 없음\");\n            // 메타 질문인지 확인 (supabaseHandler.ts에서도 체크하지만 여기서도 체크)\n            const metaQuestionPatterns = [\n                /이\\s*대화의?\\s*(핵심|요약|내용|주제)/i,\n                /대화를?\\s*(요약|정리)/i,\n                /요약해\\s*줘/i,\n                /핵심\\s*(내용|포인트)/i,\n                /주요\\s*(내용|포인트)/i\n            ];\n            const isMetaQuestion = metaQuestionPatterns.some((pattern)=>pattern.test(query));\n            if (isMetaQuestion) {\n                // 메타 질문에 대한 응답\n                return {\n                    answer: \"현재 저장된 대화의 요약 정보를 찾을 수 없습니다. 먼저 대화를 저장해주세요.\",\n                    sources: []\n                };\n            }\n            // 일반 질문에 대한 응답\n            return {\n                answer: \"관련 정보를 찾을 수 없습니다. 다른 질문을 시도하거나, 더 구체적인 질문을 해보세요. 현재 데이터베이스에 저장된 정보가 제한적일 수 있습니다.\",\n                sources: []\n            };\n        }\n        // 청크 유사도 로깅\n        similarChunks.forEach((chunk, i)=>{\n            console.log(`청크 ${i + 1}: 유사도 ${chunk.similarity?.toFixed(4) || \"N/A\"}, 세션 ID: ${chunk.chat_session_id}`);\n        });\n        // 2. 세션 정보 조회 - 타입 명시적 캐스팅 추가\n        const sessionIds = Array.from(new Set(similarChunks.map((chunk)=>chunk.chat_session_id)));\n        const sessionPromises = sessionIds.map((id)=>(0,_supabaseHandler__WEBPACK_IMPORTED_MODULE_0__.getChatSessionById)(id));\n        const sessions = await Promise.all(sessionPromises);\n        // 3. 컨텍스트 생성\n        const context = similarChunks.map((chunk, i)=>{\n            const session = sessions.find((s)=>s.id === chunk.chat_session_id);\n            return `[출처 ${i + 1}: ${session?.title || \"알 수 없음\"}]\\n${chunk.content}\\n`;\n        }).join(\"\\n\");\n        // 4. 출처 정보 생성\n        const sources = similarChunks.map((chunk)=>{\n            const session = sessions.find((s)=>s.id === chunk.chat_session_id);\n            return {\n                id: session?.id,\n                title: session?.title,\n                url: session?.url,\n                similarity: chunk.similarity\n            };\n        });\n        // 5. 프롬프트 생성\n        const prompt = `\r\n당신은 사용자의 질문에 대한 답변을 생성하는 지식 도우미입니다.\r\n아래 제공된 컨텍스트를 참고하여 질문에 대한 정확하고 상세한 답변을 제공해주세요.\r\n답변은 컨텍스트에 제공된 내용만을 토대로 해야 합니다.\r\n알 수 없거나 컨텍스트에 없는 정보에 대해서는 \"이 정보는 제공된 컨텍스트에 없습니다.\"라고 답해주세요.\r\n\r\n컨텍스트:\r\n${context}\r\n\r\n질문: ${query}\r\n\r\n답변:`;\n        // 6. OpenAI API로 응답 생성\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-4.1-nano\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"당신은 정확하고 도움이 되는 질의응답 지식 도우미입니다.\"\n                },\n                {\n                    role: \"user\",\n                    content: prompt\n                }\n            ],\n            temperature: 0.5,\n            max_tokens: 1000\n        });\n        const answer = completion.choices[0].message.content?.trim() || \"응답을 생성할 수 없습니다.\";\n        return {\n            answer,\n            sources: sources.slice(0, 3) // 상위 3개 출처만 반환\n        };\n    } catch (error) {\n        console.error(\"RAG 응답 생성 오류:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU82QyxJQUFJLENBQUNDLFdBQVcsQ0FBQ0MsTUFBTSxDQUFDO1lBQ3REQyxPQUFPO1lBQ1BDLFVBQVU7Z0JBQ1I7b0JBQUVDLE1BQU07b0JBQVVWLFNBQVM7Z0JBQWtDO2dCQUM3RDtvQkFBRVUsTUFBTTtvQkFBUVYsU0FBU0c7Z0JBQU87YUFDakM7WUFDRFEsYUFBYTtZQUNiQyxZQUFZO1FBQ2Q7UUFFQSxNQUFNbEMsU0FBUzBCLFdBQVdTLE9BQU8sQ0FBQyxFQUFFLENBQUNDLE9BQU8sQ0FBQ2QsT0FBTyxFQUFFZSxVQUFVO1FBRWhFLE9BQU87WUFDTHJDO1lBQ0FDLFNBQVNBLFFBQVFxQyxLQUFLLENBQUMsR0FBRyxHQUFHLGVBQWU7UUFDOUM7SUFDRixFQUFFLE9BQU9DLE9BQU87UUFDZGhELFFBQVFnRCxLQUFLLENBQUMsaUJBQWlCQTtRQUMvQixNQUFNQTtJQUNSO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wa20tcHJvamVjdC8uL3NyYy91dGlscy9sYW5nY2hhaW4udHM/YzExYSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcGVuQUkgfSBmcm9tICdvcGVuYWknO1xyXG5pbXBvcnQgeyBzZWFyY2hTaW1pbGFyQ2h1bmtzLCBnZXRDaGF0U2Vzc2lvbkJ5SWQgfSBmcm9tICcuL3N1cGFiYXNlSGFuZGxlcic7XHJcbmltcG9ydCB7IENoYXRDaHVuaywgQ2hhdFNlc3Npb24sIFJhZ1Jlc3BvbnNlLCBSYWdTb3VyY2UgfSBmcm9tICdAL3R5cGVzJztcclxuXHJcbi8vIE9wZW5BSSBBUEkg7YG065287J207Ja47Yq4IOy0iOq4sO2ZlFxyXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcclxuICBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZLFxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiDsp4jrrLjsl5Ag64yA7ZWcIFJBRyDquLDrsJgg7J2R64u17J2EIOyDneyEse2VqeuLiOuLpC5cclxuICogQHBhcmFtIHF1ZXJ5IOyCrOyaqeyekCDsp4jrrLhcclxuICogQHBhcmFtIHNpbWlsYXJpdHkg7Jyg7IKs64+EIOyehOqzhOqwkiAoMC4wIH4gMS4wKVxyXG4gKiBAcGFyYW0gbGltaXQg6rKA7IOJ7ZWgIOy1nOuMgCDssq3tgawg7IiYXHJcbiAqIEByZXR1cm5zIOydkeuLtSDqsJ3ssrRcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVJhZ1Jlc3BvbnNlKFxyXG4gIHF1ZXJ5OiBzdHJpbmcsXHJcbiAgc2ltaWxhcml0eTogbnVtYmVyID0gMC4zLFxyXG4gIGxpbWl0OiBudW1iZXIgPSAxMFxyXG4pOiBQcm9taXNlPFJhZ1Jlc3BvbnNlPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKGBSQUcg6rKA7IOJIOyLnOyekSAtIOy/vOumrDogXCIke3F1ZXJ5fVwiLCDsnKDsgqzrj4Qg7J6E6rOE6rCSOiAke3NpbWlsYXJpdHl9LCDsoJztlZw6ICR7bGltaXR9YCk7XHJcbiAgICBcclxuICAgIC8vIDEuIOycoOyCrO2VnCDssq3tgawg6rKA7IOJXHJcbiAgICBjb25zdCBzaW1pbGFyQ2h1bmtzID0gYXdhaXQgc2VhcmNoU2ltaWxhckNodW5rcyhxdWVyeSwgc2ltaWxhcml0eSwgbGltaXQpO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhg6rKA7IOJ65CcIOyyre2BrCDsiJg6ICR7c2ltaWxhckNodW5rcz8ubGVuZ3RoIHx8IDB9YCk7XHJcbiAgICBcclxuICAgIGlmICghc2ltaWxhckNodW5rcyB8fCBzaW1pbGFyQ2h1bmtzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICBjb25zb2xlLmxvZygn6rSA66CoIOyyre2BrOulvCDssL7snYQg7IiYIOyXhuydjCcpO1xyXG4gICAgICBcclxuICAgICAgLy8g66mU7YOAIOyniOusuOyduOyngCDtmZXsnbggKHN1cGFiYXNlSGFuZGxlci50c+yXkOyEnOuPhCDssrTtgaztlZjsp4Drp4wg7Jes6riw7ISc64+EIOyytO2BrClcclxuICAgICAgY29uc3QgbWV0YVF1ZXN0aW9uUGF0dGVybnMgPSBbXHJcbiAgICAgICAgL+ydtFxccyrrjIDtmZTsnZg/XFxzKijtlbXsi6x87JqU7JW9fOuCtOyaqXzso7zsoJwpL2ksXHJcbiAgICAgICAgL+uMgO2ZlOulvD9cXHMqKOyalOyVvXzsoJXrpqwpL2ksXHJcbiAgICAgICAgL+yalOyVve2VtFxccyrspJgvaSxcclxuICAgICAgICAv7ZW17IusXFxzKijrgrTsmql87Y+s7J247Yq4KS9pLFxyXG4gICAgICAgIC/so7zsmpRcXHMqKOuCtOyaqXztj6zsnbjtirgpL2lcclxuICAgICAgXTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGlzTWV0YVF1ZXN0aW9uID0gbWV0YVF1ZXN0aW9uUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IHBhdHRlcm4udGVzdChxdWVyeSkpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGlzTWV0YVF1ZXN0aW9uKSB7XHJcbiAgICAgICAgLy8g66mU7YOAIOyniOusuOyXkCDrjIDtlZwg7J2R64u1XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGFuc3dlcjogXCLtmITsnqwg7KCA7J6l65CcIOuMgO2ZlOydmCDsmpTslb0g7KCV67O066W8IOywvuydhCDsiJgg7JeG7Iq164uI64ukLiDrqLzsoIAg64yA7ZmU66W8IOyggOyepe2VtOyjvOyEuOyalC5cIixcclxuICAgICAgICAgIHNvdXJjZXM6IFtdXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8g7J2867CYIOyniOusuOyXkCDrjIDtlZwg7J2R64u1XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgYW5zd2VyOiBcIuq0gOugqCDsoJXrs7Trpbwg7LC+7J2EIOyImCDsl4bsirXri4jri6QuIOuLpOuluCDsp4jrrLjsnYQg7Iuc64+E7ZWY6rGw64KYLCDrjZQg6rWs7LK07KCB7J24IOyniOusuOydhCDtlbTrs7TshLjsmpQuIO2YhOyerCDrjbDsnbTthLDrsqDsnbTsiqTsl5Ag7KCA7J6l65CcIOygleuztOqwgCDsoJztlZzsoIHsnbwg7IiYIOyeiOyKteuLiOuLpC5cIixcclxuICAgICAgICBzb3VyY2VzOiBbXVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDssq3tgawg7Jyg7IKs64+EIOuhnOq5hVxyXG4gICAgc2ltaWxhckNodW5rcy5mb3JFYWNoKChjaHVuaywgaSkgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhg7LKt7YGsICR7aSsxfTog7Jyg7IKs64+EICR7Y2h1bmsuc2ltaWxhcml0eT8udG9GaXhlZCg0KSB8fCAnTi9BJ30sIOyEuOyFmCBJRDogJHtjaHVuay5jaGF0X3Nlc3Npb25faWR9YCk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLy8gMi4g7IS47IWYIOygleuztCDsobDtmowgLSDtg4DsnoUg66qF7Iuc7KCBIOy6kOyKpO2MhSDstpTqsIBcclxuICAgIGNvbnN0IHNlc3Npb25JZHM6IHN0cmluZ1tdID0gQXJyYXkuZnJvbShcclxuICAgICAgbmV3IFNldChzaW1pbGFyQ2h1bmtzLm1hcCgoY2h1bms6IENoYXRDaHVuaykgPT4gY2h1bmsuY2hhdF9zZXNzaW9uX2lkKSlcclxuICAgICk7XHJcbiAgICBcclxuICAgIGNvbnN0IHNlc3Npb25Qcm9taXNlcyA9IHNlc3Npb25JZHMubWFwKGlkID0+IGdldENoYXRTZXNzaW9uQnlJZChpZCkpO1xyXG4gICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCBQcm9taXNlLmFsbChzZXNzaW9uUHJvbWlzZXMpO1xyXG4gICAgXHJcbiAgICAvLyAzLiDsu6jthY3siqTtirgg7IOd7ISxXHJcbiAgICBjb25zdCBjb250ZXh0ID0gc2ltaWxhckNodW5rcy5tYXAoKGNodW5rOiBDaGF0Q2h1bmssIGk6IG51bWJlcikgPT4ge1xyXG4gICAgICBjb25zdCBzZXNzaW9uID0gc2Vzc2lvbnMuZmluZCgoczogQ2hhdFNlc3Npb24pID0+IHMuaWQgPT09IGNodW5rLmNoYXRfc2Vzc2lvbl9pZCk7XHJcbiAgICAgIHJldHVybiBgW+y2nOyymCAke2krMX06ICR7c2Vzc2lvbj8udGl0bGUgfHwgJ+yVjCDsiJgg7JeG7J2MJ31dXFxuJHtjaHVuay5jb250ZW50fVxcbmA7XHJcbiAgICB9KS5qb2luKCdcXG4nKTtcclxuICAgIFxyXG4gICAgLy8gNC4g7Lac7LKYIOygleuztCDsg53shLFcclxuICAgIGNvbnN0IHNvdXJjZXM6IFJhZ1NvdXJjZVtdID0gc2ltaWxhckNodW5rcy5tYXAoKGNodW5rOiBDaGF0Q2h1bmspID0+IHtcclxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IHNlc3Npb25zLmZpbmQoKHM6IENoYXRTZXNzaW9uKSA9PiBzLmlkID09PSBjaHVuay5jaGF0X3Nlc3Npb25faWQpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlkOiBzZXNzaW9uPy5pZCxcclxuICAgICAgICB0aXRsZTogc2Vzc2lvbj8udGl0bGUsXHJcbiAgICAgICAgdXJsOiBzZXNzaW9uPy51cmwsXHJcbiAgICAgICAgc2ltaWxhcml0eTogY2h1bmsuc2ltaWxhcml0eVxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIDUuIO2UhOuhrO2UhO2KuCDsg53shLFcclxuICAgIGNvbnN0IHByb21wdCA9IGBcclxu64u57Iug7J2AIOyCrOyaqeyekOydmCDsp4jrrLjsl5Ag64yA7ZWcIOuLteuzgOydhCDsg53shLHtlZjripQg7KeA7IudIOuPhOyasOuvuOyeheuLiOuLpC5cclxu7JWE656YIOygnOqzteuQnCDsu6jthY3siqTtirjrpbwg7LC46rOg7ZWY7JesIOyniOusuOyXkCDrjIDtlZwg7KCV7ZmV7ZWY6rOgIOyDgeyEuO2VnCDri7Xrs4DsnYQg7KCc6rO17ZW07KO87IS47JqULlxyXG7ri7Xrs4DsnYAg7Luo7YWN7Iqk7Yq47JeQIOygnOqzteuQnCDrgrTsmqnrp4zsnYQg7Yag64yA66GcIO2VtOyVvCDtlanri4jri6QuXHJcbuyVjCDsiJgg7JeG6rGw64KYIOy7qO2FjeyKpO2KuOyXkCDsl4bripQg7KCV67O07JeQIOuMgO2VtOyEnOuKlCBcIuydtCDsoJXrs7TripQg7KCc6rO165CcIOy7qO2FjeyKpO2KuOyXkCDsl4bsirXri4jri6QuXCLrnbzqs6Ag64u17ZW07KO87IS47JqULlxyXG5cclxu7Luo7YWN7Iqk7Yq4OlxyXG4ke2NvbnRleHR9XHJcblxyXG7sp4jrrLg6ICR7cXVlcnl9XHJcblxyXG7ri7Xrs4A6YDtcclxuICAgIFxyXG4gICAgLy8gNi4gT3BlbkFJIEFQSeuhnCDsnZHri7Ug7IOd7ISxXHJcbiAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcclxuICAgICAgbW9kZWw6IFwiZ3B0LTQuMS1uYW5vXCIsXHJcbiAgICAgIG1lc3NhZ2VzOiBbXHJcbiAgICAgICAgeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBcIuuLueyLoOydgCDsoJXtmZXtlZjqs6Ag64+E7JuA7J20IOuQmOuKlCDsp4jsnZjsnZHri7Ug7KeA7IudIOuPhOyasOuvuOyeheuLiOuLpC5cIiB9LFxyXG4gICAgICAgIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IHByb21wdCB9XHJcbiAgICAgIF0sXHJcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjUsXHJcbiAgICAgIG1heF90b2tlbnM6IDEwMDBcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBjb25zdCBhbnN3ZXIgPSBjb21wbGV0aW9uLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50Py50cmltKCkgfHwgXCLsnZHri7XsnYQg7IOd7ISx7ZWgIOyImCDsl4bsirXri4jri6QuXCI7XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGFuc3dlcixcclxuICAgICAgc291cmNlczogc291cmNlcy5zbGljZSgwLCAzKSAvLyDsg4HsnIQgM+qwnCDstpzsspjrp4wg67CY7ZmYXHJcbiAgICB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdSQUcg7J2R64u1IOyDneyEsSDsmKTrpZg6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJPcGVuQUkiLCJzZWFyY2hTaW1pbGFyQ2h1bmtzIiwiZ2V0Q2hhdFNlc3Npb25CeUlkIiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiZ2VuZXJhdGVSYWdSZXNwb25zZSIsInF1ZXJ5Iiwic2ltaWxhcml0eSIsImxpbWl0IiwiY29uc29sZSIsImxvZyIsInNpbWlsYXJDaHVua3MiLCJsZW5ndGgiLCJtZXRhUXVlc3Rpb25QYXR0ZXJucyIsImlzTWV0YVF1ZXN0aW9uIiwic29tZSIsInBhdHRlcm4iLCJ0ZXN0IiwiYW5zd2VyIiwic291cmNlcyIsImZvckVhY2giLCJjaHVuayIsImkiLCJ0b0ZpeGVkIiwiY2hhdF9zZXNzaW9uX2lkIiwic2Vzc2lvbklkcyIsIkFycmF5IiwiZnJvbSIsIlNldCIsIm1hcCIsInNlc3Npb25Qcm9taXNlcyIsImlkIiwic2Vzc2lvbnMiLCJQcm9taXNlIiwiYWxsIiwiY29udGV4dCIsInNlc3Npb24iLCJmaW5kIiwicyIsInRpdGxlIiwiY29udGVudCIsImpvaW4iLCJ1cmwiLCJwcm9tcHQiLCJjb21wbGV0aW9uIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibW9kZWwiLCJtZXNzYWdlcyIsInJvbGUiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJjaG9pY2VzIiwibWVzc2FnZSIsInRyaW0iLCJzbGljZSIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/utils/langchain.ts\n");

/***/ }),

/***/ "(rsc)/./src/utils/supabaseHandler.ts":
/*!**************************************!*\
  !*** ./src/utils/supabaseHandler.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkUrlExists: () => (/* binding */ checkUrlExists),\n/* harmony export */   getAllChatSessions: () => (/* binding */ getAllChatSessions),\n/* harmony export */   getChatSessionById: () => (/* binding */ getChatSessionById),\n/* harmony export */   getChunksBySessionId: () => (/* binding */ getChunksBySessionId),\n/* harmony export */   insertChatSession: () => (/* binding */ insertChatSession),\n/* harmony export */   processAndInsertChunks: () => (/* binding */ processAndInsertChunks),\n/* harmony export */   searchChatSessions: () => (/* binding */ searchChatSessions),\n/* harmony export */   searchSimilarChunks: () => (/* binding */ searchSimilarChunks),\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./src/lib/supabase.ts\");\n/* harmony import */ var _embeddings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./embeddings */ \"(rsc)/./src/utils/embeddings.ts\");\n\n\n// Supabase 클라이언트 재사용\nconst supabase = _lib_supabase__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin;\n/**\r\n * JSON 데이터를 안전하게 처리합니다.\r\n * PostgreSQL에 저장하기 전 유효하지 않은 문자나 구조를 제거합니다.\r\n */ function sanitizeJsonData(data) {\n    if (!data) return null;\n    if (typeof data === \"string\") {\n        // 문자열에서 제어 문자 제거 및 유니코드 문자 처리 개선\n        return data.replace(/[\\u0000-\\u001F\\u007F-\\u009F]/g, \" \") // 제어 문자 제거\n        .replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, (match)=>match) // 올바른 유니코드 이모지 유지\n        .replace(/\\uFFFD/g, \"\") // 대체 문자 제거\n        .replace(/\\s+/g, \" \") // 연속된 공백 제거\n        .trim();\n    }\n    if (Array.isArray(data)) {\n        // 배열의 각 항목 정제\n        return data.map((item)=>sanitizeJsonData(item));\n    }\n    if (typeof data === \"object\" && data !== null) {\n        // 객체의 각 필드 정제\n        const sanitized = {};\n        for(const key in data){\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                sanitized[key] = sanitizeJsonData(data[key]);\n            }\n        }\n        return sanitized;\n    }\n    // 기본 자료형은 그대로 반환\n    return data;\n}\n/**\r\n * URL이 이미 저장되어 있는지 확인합니다.\r\n * @param url 확인할 URL\r\n * @returns 중복 여부와 기존 세션 정보\r\n */ async function checkUrlExists(url) {\n    try {\n        // URL 정규화 (쿼리 파라미터 등 제거)\n        const normalizedUrl = new URL(url).origin + new URL(url).pathname;\n        // 정규화된 URL로 시작하는 세션 검색\n        const { data, error } = await supabase.from(\"chat_sessions\").select(\"id, title, url, summary, created_at\").ilike(\"url\", `${normalizedUrl}%`).limit(1);\n        if (error) {\n            console.error(\"URL 중복 확인 중 오류:\", error);\n            throw error;\n        }\n        if (data && data.length > 0) {\n            return {\n                exists: true,\n                session: data[0]\n            };\n        }\n        return {\n            exists: false\n        };\n    } catch (error) {\n        console.error(\"URL 중복 확인 중 오류:\", error);\n        // 오류 발생 시 안전하게 중복이 아닌 것으로 처리\n        return {\n            exists: false\n        };\n    }\n}\n/**\r\n * 대화 세션을 Supabase에 저장합니다.\r\n */ async function insertChatSession({ title, url, summary, messages, metadata = {}, skipDuplicateCheck = false }) {\n    try {\n        // URL 중복 확인 (skipDuplicateCheck가 false일 때만)\n        if (!skipDuplicateCheck && url) {\n            const { exists, session } = await checkUrlExists(url);\n            if (exists) {\n                console.log(`URL이 이미 존재합니다: ${url}`);\n                console.log(`기존 세션 정보: ${session?.title} (${session?.id})`);\n                return {\n                    id: session?.id,\n                    duplicate: true,\n                    message: \"이미 저장된 대화입니다.\"\n                };\n            }\n        }\n        // 데이터 정제\n        const sanitizedTitle = sanitizeJsonData(title);\n        const sanitizedSummary = sanitizeJsonData(summary);\n        const sanitizedMessages = sanitizeJsonData(messages);\n        const sanitizedMetadata = sanitizeJsonData(metadata);\n        // 요약 텍스트 임베딩 생성\n        const embedding = await (0,_embeddings__WEBPACK_IMPORTED_MODULE_1__.getEmbedding)(sanitizedSummary);\n        // 세션 데이터 삽입\n        const { data, error } = await supabase.from(\"chat_sessions\").insert({\n            title: sanitizedTitle,\n            url,\n            summary: sanitizedSummary,\n            messages: sanitizedMessages,\n            metadata: sanitizedMetadata,\n            embedding\n        }).select(\"id\").single();\n        if (error) throw error;\n        return {\n            ...data,\n            duplicate: false\n        };\n    } catch (error) {\n        console.error(\"대화 세션 저장 중 오류:\", error);\n        throw error;\n    }\n}\n/**\r\n * 대화 청크를 생성하고 Supabase에 저장합니다.\r\n */ async function processAndInsertChunks(sessionId, messages) {\n    try {\n        // 메시지 정제\n        const sanitizedMessages = sanitizeJsonData(messages);\n        // 메시지를 청크로 분할\n        const chunks = (0,_embeddings__WEBPACK_IMPORTED_MODULE_1__.chunkMessages)(sanitizedMessages);\n        console.log(\"\\uD83E\\uDDF1 분할된 청크:\", chunks);\n        // 각 청크에 대해 임베딩 생성 및 저장\n        const chunkPromises = chunks.map(async (chunk)=>{\n            // 청크 내용 정제\n            const sanitizedContent = sanitizeJsonData(chunk.content);\n            const embedding = await (0,_embeddings__WEBPACK_IMPORTED_MODULE_1__.getEmbedding)(sanitizedContent);\n            return {\n                chat_session_id: sessionId,\n                chunk_index: chunk.chunk_index,\n                content: sanitizedContent,\n                embedding\n            };\n        });\n        // 모든 청크 임베딩 처리 완료 대기\n        const chunksWithEmbeddings = await Promise.all(chunkPromises);\n        // 청크 데이터 삽입 (최대 1MB 제한으로 청크 10개씩 배치 처리)\n        const batchSize = 10;\n        const results = [];\n        for(let i = 0; i < chunksWithEmbeddings.length; i += batchSize){\n            const batch = chunksWithEmbeddings.slice(i, i + batchSize);\n            try {\n                const { data, error } = await supabase.from(\"chat_chunks\").insert(batch);\n                if (error) throw error;\n                results.push(data);\n            } catch (error) {\n                console.error(`청크 배치 ${i}/${chunksWithEmbeddings.length} 저장 중 오류:`, error);\n            // 개별 청크 에러를 기록하되 전체 프로세스는 계속 진행\n            }\n        }\n        return {\n            success: true,\n            count: chunksWithEmbeddings.length\n        };\n    } catch (error) {\n        console.error(\"청크 처리 및 저장 중 오류:\", error);\n        throw error;\n    }\n}\n/**\r\n * 유사한 청크를 검색합니다.\r\n */ async function searchSimilarChunks(query, similarity = 0.3, limit = 10) {\n    try {\n        // 메타 질문 감지 (예: \"이 대화의 핵심이 뭐야?\", \"요약해줘\" 등)\n        const metaQuestionPatterns = [\n            /이\\s*대화의?\\s*(핵심|요약|내용|주제)/i,\n            /대화를?\\s*(요약|정리)/i,\n            /요약해\\s*줘/i,\n            /핵심\\s*(내용|포인트)/i,\n            /주요\\s*(내용|포인트)/i\n        ];\n        const isMetaQuestion = metaQuestionPatterns.some((pattern)=>pattern.test(query));\n        if (isMetaQuestion) {\n            console.log(\"메타 질문 감지됨, 모든 세션의 요약 정보를 검색합니다.\");\n            // 메타 질문인 경우 가장 최근 세션의 요약 정보를 가져오기\n            const { data: sessionData, error: sessionError } = await supabase.from(\"chat_sessions\").select(\"id, title, summary\").order(\"created_at\", {\n                ascending: false\n            }).limit(1);\n            if (sessionError || !sessionData || sessionData.length === 0) {\n                console.warn(\"세션 데이터를 찾을 수 없습니다.\");\n                return [];\n            }\n            // 세션의 요약 정보를 청크로 변환하여 반환\n            const session = sessionData[0];\n            const fakeChunk = {\n                id: \"meta-question-chunk\",\n                chat_session_id: session.id,\n                chunk_index: 0,\n                content: `[요약]: ${session.summary}`,\n                similarity: 1.0\n            };\n            return [\n                fakeChunk\n            ];\n        }\n        console.log(`검색 쿼리: \"${query}\", 유사도 임계값: ${similarity}, 제한: ${limit}`);\n        // 쿼리 텍스트 정제\n        const sanitizedQuery = sanitizeJsonData(query);\n        console.log(`정제된 쿼리: \"${sanitizedQuery}\"`);\n        if (!sanitizedQuery || sanitizedQuery.trim().length < 2) {\n            console.warn(\"쿼리가 너무 짧거나 비어 있습니다\");\n            return [];\n        }\n        // 쿼리 텍스트 임베딩 생성\n        const queryEmbedding = await (0,_embeddings__WEBPACK_IMPORTED_MODULE_1__.getEmbedding)(sanitizedQuery);\n        console.log(`임베딩 생성 완료: ${queryEmbedding.length} 차원`);\n        // 유사한 청크 검색\n        const { data, error } = await supabase.rpc(\"match_chunks\", {\n            query_embedding: queryEmbedding,\n            match_threshold: similarity,\n            match_count: limit\n        });\n        if (error) {\n            console.error(\"유사 청크 검색 오류:\", error);\n            throw error;\n        }\n        console.log(`검색된 청크 수: ${data?.length || 0}`);\n        // 검색 결과가 없는 경우 유사도 임계값을 낮춰서 다시 시도 (2단계로 낮춤)\n        if (!data || data.length === 0) {\n            // 첫 번째 재시도: 임계값을 50% 낮춤\n            const lowerThreshold = similarity * 0.5;\n            console.log(`결과가 없어 유사도 임계값을 ${lowerThreshold.toFixed(2)}로 낮춰 재시도`);\n            const { data: retryData, error: retryError } = await supabase.rpc(\"match_chunks\", {\n                query_embedding: queryEmbedding,\n                match_threshold: lowerThreshold,\n                match_count: limit\n            });\n            if (retryError) {\n                console.error(\"낮은 임계값으로 재시도 중 오류:\", retryError);\n            } else if (retryData && retryData.length > 0) {\n                console.log(`낮은 임계값으로 ${retryData.length}개 청크 검색됨`);\n                return retryData;\n            } else {\n                // 두 번째 재시도: 매우 낮은 임계값 (0.1)으로 시도\n                const lowestThreshold = 0.1;\n                console.log(`결과가 여전히 없어 최저 임계값 ${lowestThreshold.toFixed(2)}로 재시도`);\n                const { data: lastRetryData, error: lastRetryError } = await supabase.rpc(\"match_chunks\", {\n                    query_embedding: queryEmbedding,\n                    match_threshold: lowestThreshold,\n                    match_count: limit\n                });\n                if (lastRetryError) {\n                    console.error(\"최저 임계값으로 재시도 중 오류:\", lastRetryError);\n                } else if (lastRetryData && lastRetryData.length > 0) {\n                    console.log(`최저 임계값으로 ${lastRetryData.length}개 청크 검색됨`);\n                    return lastRetryData;\n                }\n            }\n        }\n        return data || [];\n    } catch (error) {\n        console.error(\"유사 청크 검색 중 오류:\", error);\n        throw error;\n    }\n}\n/**\r\n * 세션 ID로 대화 세션을 조회합니다.\r\n */ async function getChatSessionById(id) {\n    const { data, error } = await supabase.from(\"chat_sessions\").select(\"*\").eq(\"id\", id).single();\n    if (error) throw error;\n    return data;\n}\n/**\r\n * 모든 대화 세션을 조회합니다.\r\n * 요약 정보만 반환합니다 (전체 메시지는 제외).\r\n */ async function getAllChatSessions() {\n    const { data, error } = await supabase.from(\"chat_sessions\").select(\"id, title, url, summary, created_at, metadata\").order(\"created_at\", {\n        ascending: false\n    });\n    if (error) throw error;\n    return data;\n}\n/**\r\n * 대화 세션의 모든 청크를 가져옵니다.\r\n */ async function getChunksBySessionId(sessionId) {\n    const { data, error } = await supabase.from(\"chat_chunks\").select(\"*\").eq(\"chat_session_id\", sessionId).order(\"chunk_index\", {\n        ascending: true\n    });\n    if (error) throw error;\n    return data;\n}\n/**\r\n * 키워드로 대화 세션을 검색합니다.\r\n */ async function searchChatSessions(keyword) {\n    const { data, error } = await supabase.from(\"chat_sessions\").select(\"id, title, url, summary, created_at, metadata\").or(`title.ilike.%${keyword}%,summary.ilike.%${keyword}%`).order(\"created_at\", {\n        ascending: false\n    });\n    if (error) throw error;\n    return data;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SyxFQUFFLEdBQUcsTUFBTXRCLFNBQzNCdUIsSUFBSSxDQUFDLGVBQ0xDLE1BQU0sQ0FBQyxLQUNQd0UsRUFBRSxDQUFDLG1CQUFtQi9DLFdBQ3RCNkIsS0FBSyxDQUFDLGVBQWU7UUFBRUMsV0FBVztJQUFLO0lBRTFDLElBQUl6RCxPQUFPLE1BQU1BO0lBRWpCLE9BQU9wQjtBQUNUO0FBRUE7O0NBRUMsR0FDTSxlQUFlaUcsbUJBQW1CQyxPQUFlO0lBQ3RELE1BQU0sRUFBRWxHLElBQUksRUFBRW9CLEtBQUssRUFBRSxHQUFHLE1BQU10QixTQUMzQnVCLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDLGlEQUNQNkUsRUFBRSxDQUFDLENBQUMsYUFBYSxFQUFFRCxRQUFRLGlCQUFpQixFQUFFQSxRQUFRLENBQUMsQ0FBQyxFQUN4RHRCLEtBQUssQ0FBQyxjQUFjO1FBQUVDLFdBQVc7SUFBTTtJQUUxQyxJQUFJekQsT0FBTyxNQUFNQTtJQUVqQixPQUFPcEI7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL3BrbS1wcm9qZWN0Ly4vc3JjL3V0aWxzL3N1cGFiYXNlSGFuZGxlci50cz85YmZmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAL2xpYi9zdXBhYmFzZSc7XHJcbmltcG9ydCB7IENoYXRNZXNzYWdlLCBDaGF0Q2h1bmssIENoYXRTZXNzaW9uIH0gZnJvbSAnQC90eXBlcyc7XHJcbmltcG9ydCB7IGdldEVtYmVkZGluZywgY2h1bmtNZXNzYWdlcyB9IGZyb20gJy4vZW1iZWRkaW5ncyc7XHJcblxyXG4vLyBTdXBhYmFzZSDtgbTrnbzsnbTslrjtirgg7J6s7IKs7JqpXHJcbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IHN1cGFiYXNlQWRtaW47XHJcblxyXG4vKipcclxuICogSlNPTiDrjbDsnbTthLDrpbwg7JWI7KCE7ZWY6rKMIOyymOumrO2VqeuLiOuLpC5cclxuICogUG9zdGdyZVNRTOyXkCDsoIDsnqXtlZjquLAg7KCEIOycoO2aqO2VmOyngCDslYrsnYAg66y47J6Q64KYIOq1rOyhsOulvCDsoJzqsbDtlanri4jri6QuXHJcbiAqL1xyXG5mdW5jdGlvbiBzYW5pdGl6ZUpzb25EYXRhKGRhdGE6IGFueSk6IGFueSB7XHJcbiAgaWYgKCFkYXRhKSByZXR1cm4gbnVsbDtcclxuICBcclxuICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAvLyDrrLjsnpDsl7Tsl5DshJwg7KCc7Ja0IOusuOyekCDsoJzqsbAg67CPIOycoOuLiOy9lOuTnCDrrLjsnpAg7LKY66asIOqwnOyEoFxyXG4gICAgcmV0dXJuIGRhdGFcclxuICAgICAgLnJlcGxhY2UoL1tcXHUwMDAwLVxcdTAwMUZcXHUwMDdGLVxcdTAwOUZdL2csICcgJykgIC8vIOygnOyWtCDrrLjsnpAg7KCc6rGwXHJcbiAgICAgIC5yZXBsYWNlKC9bXFx1RDgwMC1cXHVEQkZGXVtcXHVEQzAwLVxcdURGRkZdL2csIG1hdGNoID0+IG1hdGNoKSAvLyDsmKzrsJTrpbgg7Jyg64uI7L2U65OcIOydtOuqqOyngCDsnKDsp4BcclxuICAgICAgLnJlcGxhY2UoL1xcdUZGRkQvZywgJycpIC8vIOuMgOyytCDrrLjsnpAg7KCc6rGwXHJcbiAgICAgIC5yZXBsYWNlKC9cXHMrL2csICcgJykgLy8g7Jew7IaN65CcIOqzteuwsSDsoJzqsbBcclxuICAgICAgLnRyaW0oKTtcclxuICB9XHJcbiAgXHJcbiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgIC8vIOuwsOyXtOydmCDqsIEg7ZWt66qpIOygleygnFxyXG4gICAgcmV0dXJuIGRhdGEubWFwKGl0ZW0gPT4gc2FuaXRpemVKc29uRGF0YShpdGVtKSk7XHJcbiAgfVxyXG4gIFxyXG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgZGF0YSAhPT0gbnVsbCkge1xyXG4gICAgLy8g6rCd7LK07J2YIOqwgSDtlYTrk5wg7KCV7KCcXHJcbiAgICBjb25zdCBzYW5pdGl6ZWQ6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcclxuICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcclxuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpKSB7XHJcbiAgICAgICAgc2FuaXRpemVkW2tleV0gPSBzYW5pdGl6ZUpzb25EYXRhKGRhdGFba2V5XSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBzYW5pdGl6ZWQ7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIOq4sOuzuCDsnpDro4ztmJXsnYAg6re464yA66GcIOuwmO2ZmFxyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICogVVJM7J20IOydtOuvuCDsoIDsnqXrkJjslrQg7J6I64qU7KeAIO2ZleyduO2VqeuLiOuLpC5cclxuICogQHBhcmFtIHVybCDtmZXsnbjtlaAgVVJMXHJcbiAqIEByZXR1cm5zIOykkeuztSDsl6zrtoDsmYAg6riw7KG0IOyEuOyFmCDsoJXrs7RcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1VybEV4aXN0cyh1cmw6IHN0cmluZyk6IFByb21pc2U8eyBleGlzdHM6IGJvb2xlYW47IHNlc3Npb24/OiBQYXJ0aWFsPENoYXRTZXNzaW9uPiB9PiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFVSTCDsoJXqt5ztmZQgKOy/vOumrCDtjIzrnbzrr7jthLAg65OxIOygnOqxsClcclxuICAgIGNvbnN0IG5vcm1hbGl6ZWRVcmwgPSBuZXcgVVJMKHVybCkub3JpZ2luICsgbmV3IFVSTCh1cmwpLnBhdGhuYW1lO1xyXG4gICAgXHJcbiAgICAvLyDsoJXqt5ztmZTrkJwgVVJM66GcIOyLnOyeke2VmOuKlCDshLjshZgg6rKA7IOJXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY2hhdF9zZXNzaW9ucycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCB0aXRsZSwgdXJsLCBzdW1tYXJ5LCBjcmVhdGVkX2F0JylcclxuICAgICAgLmlsaWtlKCd1cmwnLCBgJHtub3JtYWxpemVkVXJsfSVgKVxyXG4gICAgICAubGltaXQoMSk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdVUkwg7KSR67O1IO2ZleyduCDspJEg7Jik66WYOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICByZXR1cm4geyBleGlzdHM6IHRydWUsIHNlc3Npb246IGRhdGFbMF0gfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHsgZXhpc3RzOiBmYWxzZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdVUkwg7KSR67O1IO2ZleyduCDspJEg7Jik66WYOicsIGVycm9yKTtcclxuICAgIC8vIOyYpOulmCDrsJzsg50g7IucIOyViOyghO2VmOqyjCDspJHrs7XsnbQg7JWE64uMIOqyg+ycvOuhnCDsspjrpqxcclxuICAgIHJldHVybiB7IGV4aXN0czogZmFsc2UgfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDrjIDtmZQg7IS47IWY7J2EIFN1cGFiYXNl7JeQIOyggOyepe2VqeuLiOuLpC5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbnNlcnRDaGF0U2Vzc2lvbih7XHJcbiAgdGl0bGUsXHJcbiAgdXJsLFxyXG4gIHN1bW1hcnksXHJcbiAgbWVzc2FnZXMsXHJcbiAgbWV0YWRhdGEgPSB7fSxcclxuICBza2lwRHVwbGljYXRlQ2hlY2sgPSBmYWxzZVxyXG59OiB7XHJcbiAgdGl0bGU6IHN0cmluZztcclxuICB1cmw6IHN0cmluZztcclxuICBzdW1tYXJ5OiBzdHJpbmc7XHJcbiAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG4gIHNraXBEdXBsaWNhdGVDaGVjaz86IGJvb2xlYW47XHJcbn0pIHtcclxuICB0cnkge1xyXG4gICAgLy8gVVJMIOykkeuztSDtmZXsnbggKHNraXBEdXBsaWNhdGVDaGVja+qwgCBmYWxzZeydvCDrlYzrp4wpXHJcbiAgICBpZiAoIXNraXBEdXBsaWNhdGVDaGVjayAmJiB1cmwpIHtcclxuICAgICAgY29uc3QgeyBleGlzdHMsIHNlc3Npb24gfSA9IGF3YWl0IGNoZWNrVXJsRXhpc3RzKHVybCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZXhpc3RzKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFVSTOydtCDsnbTrr7gg7KG07J6s7ZWp64uI64ukOiAke3VybH1gKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhg6riw7KG0IOyEuOyFmCDsoJXrs7Q6ICR7c2Vzc2lvbj8udGl0bGV9ICgke3Nlc3Npb24/LmlkfSlgKTtcclxuICAgICAgICByZXR1cm4geyBcclxuICAgICAgICAgIGlkOiBzZXNzaW9uPy5pZCwgXHJcbiAgICAgICAgICBkdXBsaWNhdGU6IHRydWUsIFxyXG4gICAgICAgICAgbWVzc2FnZTogJ+ydtOuvuCDsoIDsnqXrkJwg64yA7ZmU7J6F64uI64ukLicgXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDrjbDsnbTthLAg7KCV7KCcXHJcbiAgICBjb25zdCBzYW5pdGl6ZWRUaXRsZSA9IHNhbml0aXplSnNvbkRhdGEodGl0bGUpO1xyXG4gICAgY29uc3Qgc2FuaXRpemVkU3VtbWFyeSA9IHNhbml0aXplSnNvbkRhdGEoc3VtbWFyeSk7XHJcbiAgICBjb25zdCBzYW5pdGl6ZWRNZXNzYWdlcyA9IHNhbml0aXplSnNvbkRhdGEobWVzc2FnZXMpO1xyXG4gICAgY29uc3Qgc2FuaXRpemVkTWV0YWRhdGEgPSBzYW5pdGl6ZUpzb25EYXRhKG1ldGFkYXRhKTtcclxuICAgIFxyXG4gICAgLy8g7JqU7JW9IO2FjeyKpO2KuCDsnoTrsqDrlKkg7IOd7ISxXHJcbiAgICBjb25zdCBlbWJlZGRpbmcgPSBhd2FpdCBnZXRFbWJlZGRpbmcoc2FuaXRpemVkU3VtbWFyeSk7XHJcbiAgICBcclxuICAgIC8vIOyEuOyFmCDrjbDsnbTthLAg7IK97J6FXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY2hhdF9zZXNzaW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIHRpdGxlOiBzYW5pdGl6ZWRUaXRsZSxcclxuICAgICAgICB1cmwsXHJcbiAgICAgICAgc3VtbWFyeTogc2FuaXRpemVkU3VtbWFyeSxcclxuICAgICAgICBtZXNzYWdlczogc2FuaXRpemVkTWVzc2FnZXMsXHJcbiAgICAgICAgbWV0YWRhdGE6IHNhbml0aXplZE1ldGFkYXRhLFxyXG4gICAgICAgIGVtYmVkZGluZ1xyXG4gICAgICB9KVxyXG4gICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIHsgLi4uZGF0YSwgZHVwbGljYXRlOiBmYWxzZSB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfrjIDtmZQg7IS47IWYIOyggOyepSDspJEg7Jik66WYOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOuMgO2ZlCDssq3tgazrpbwg7IOd7ISx7ZWY6rOgIFN1cGFiYXNl7JeQIOyggOyepe2VqeuLiOuLpC5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzQW5kSW5zZXJ0Q2h1bmtzKFxyXG4gIHNlc3Npb25JZDogc3RyaW5nLFxyXG4gIG1lc3NhZ2VzOiBDaGF0TWVzc2FnZVtdXHJcbikge1xyXG4gIHRyeSB7XHJcbiAgICAvLyDrqZTsi5zsp4Ag7KCV7KCcXHJcbiAgICBjb25zdCBzYW5pdGl6ZWRNZXNzYWdlcyA9IHNhbml0aXplSnNvbkRhdGEobWVzc2FnZXMpO1xyXG4gICAgXHJcbiAgICAvLyDrqZTsi5zsp4Drpbwg7LKt7YGs66GcIOu2hO2VoFxyXG4gICAgY29uc3QgY2h1bmtzID0gY2h1bmtNZXNzYWdlcyhzYW5pdGl6ZWRNZXNzYWdlcyk7XHJcbiAgICBjb25zb2xlLmxvZygn8J+nsSDrtoTtlaDrkJwg7LKt7YGsOicsIGNodW5rcyk7XHJcbiAgICBcclxuICAgIC8vIOqwgSDssq3tgazsl5Ag64yA7ZW0IOyehOuyoOuUqSDsg53shLEg67CPIOyggOyepVxyXG4gICAgY29uc3QgY2h1bmtQcm9taXNlcyA9IGNodW5rcy5tYXAoYXN5bmMgKGNodW5rKSA9PiB7XHJcbiAgICAgIC8vIOyyre2BrCDrgrTsmqkg7KCV7KCcXHJcbiAgICAgIGNvbnN0IHNhbml0aXplZENvbnRlbnQgPSBzYW5pdGl6ZUpzb25EYXRhKGNodW5rLmNvbnRlbnQpO1xyXG4gICAgICBjb25zdCBlbWJlZGRpbmcgPSBhd2FpdCBnZXRFbWJlZGRpbmcoc2FuaXRpemVkQ29udGVudCk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGNoYXRfc2Vzc2lvbl9pZDogc2Vzc2lvbklkLFxyXG4gICAgICAgIGNodW5rX2luZGV4OiBjaHVuay5jaHVua19pbmRleCxcclxuICAgICAgICBjb250ZW50OiBzYW5pdGl6ZWRDb250ZW50LFxyXG4gICAgICAgIGVtYmVkZGluZ1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIOuqqOuToCDssq3tgawg7J6E67Kg65SpIOyymOumrCDsmYTro4wg64yA6riwXHJcbiAgICBjb25zdCBjaHVua3NXaXRoRW1iZWRkaW5ncyA9IGF3YWl0IFByb21pc2UuYWxsKGNodW5rUHJvbWlzZXMpO1xyXG4gICAgXHJcbiAgICAvLyDssq3tgawg642w7J207YSwIOyCveyehSAo7LWc64yAIDFNQiDsoJztlZzsnLzroZwg7LKt7YGsIDEw6rCc7JSpIOuwsOy5mCDsspjrpqwpXHJcbiAgICBjb25zdCBiYXRjaFNpemUgPSAxMDtcclxuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcclxuICAgIFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaHVua3NXaXRoRW1iZWRkaW5ncy5sZW5ndGg7IGkgKz0gYmF0Y2hTaXplKSB7XHJcbiAgICAgIGNvbnN0IGJhdGNoID0gY2h1bmtzV2l0aEVtYmVkZGluZ3Muc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSk7XHJcbiAgICAgIFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgnY2hhdF9jaHVua3MnKVxyXG4gICAgICAgICAgLmluc2VydChiYXRjaCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgICAgICByZXN1bHRzLnB1c2goZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihg7LKt7YGsIOuwsOy5mCAke2l9LyR7Y2h1bmtzV2l0aEVtYmVkZGluZ3MubGVuZ3RofSDsoIDsnqUg7KSRIOyYpOulmDpgLCBlcnJvcik7XHJcbiAgICAgICAgLy8g6rCc67OEIOyyre2BrCDsl5Drn6zrpbwg6riw66Gd7ZWY65CYIOyghOyytCDtlITroZzshLjsiqTripQg6rOE7IaNIOynhO2WiVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvdW50OiBjaHVua3NXaXRoRW1iZWRkaW5ncy5sZW5ndGggfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign7LKt7YGsIOyymOumrCDrsI8g7KCA7J6lIOykkSDsmKTrpZg6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog7Jyg7IKs7ZWcIOyyre2BrOulvCDqsoDsg4ntlanri4jri6QuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VhcmNoU2ltaWxhckNodW5rcyhcclxuICBxdWVyeTogc3RyaW5nLFxyXG4gIHNpbWlsYXJpdHk6IG51bWJlciA9IDAuMywgIC8vIOq4sOuzuOqwkiAwLjXsl5DshJwgMC4z7Jy866GcIOuNlCDrgq7stqRcclxuICBsaW1pdDogbnVtYmVyID0gMTBcclxuKTogUHJvbWlzZTxDaGF0Q2h1bmtbXT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyDrqZTtg4Ag7KeI66y4IOqwkOyngCAo7JiIOiBcIuydtCDrjIDtmZTsnZgg7ZW17Ius7J20IOutkOyVvD9cIiwgXCLsmpTslb3tlbTspJhcIiDrk7EpXHJcbiAgICBjb25zdCBtZXRhUXVlc3Rpb25QYXR0ZXJucyA9IFtcclxuICAgICAgL+ydtFxccyrrjIDtmZTsnZg/XFxzKijtlbXsi6x87JqU7JW9fOuCtOyaqXzso7zsoJwpL2ksXHJcbiAgICAgIC/rjIDtmZTrpbw/XFxzKijsmpTslb187KCV66asKS9pLFxyXG4gICAgICAv7JqU7JW97ZW0XFxzKuykmC9pLFxyXG4gICAgICAv7ZW17IusXFxzKijrgrTsmql87Y+s7J247Yq4KS9pLFxyXG4gICAgICAv7KO87JqUXFxzKijrgrTsmql87Y+s7J247Yq4KS9pXHJcbiAgICBdO1xyXG4gICAgXHJcbiAgICBjb25zdCBpc01ldGFRdWVzdGlvbiA9IG1ldGFRdWVzdGlvblBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QocXVlcnkpKTtcclxuICAgIFxyXG4gICAgaWYgKGlzTWV0YVF1ZXN0aW9uKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfrqZTtg4Ag7KeI66y4IOqwkOyngOuQqCwg66qo65OgIOyEuOyFmOydmCDsmpTslb0g7KCV67O066W8IOqygOyDie2VqeuLiOuLpC4nKTtcclxuICAgICAgLy8g66mU7YOAIOyniOusuOyduCDqsr3smrAg6rCA7J6lIOy1nOq3vCDshLjshZjsnZgg7JqU7JW9IOygleuztOulvCDqsIDsoLjsmKTquLBcclxuICAgICAgY29uc3QgeyBkYXRhOiBzZXNzaW9uRGF0YSwgZXJyb3I6IHNlc3Npb25FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnY2hhdF9zZXNzaW9ucycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIHRpdGxlLCBzdW1tYXJ5JylcclxuICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgICAubGltaXQoMSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoc2Vzc2lvbkVycm9yIHx8ICFzZXNzaW9uRGF0YSB8fCBzZXNzaW9uRGF0YS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ+yEuOyFmCDrjbDsnbTthLDrpbwg7LC+7J2EIOyImCDsl4bsirXri4jri6QuJyk7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyDshLjshZjsnZgg7JqU7JW9IOygleuztOulvCDssq3tgazroZwg67OA7ZmY7ZWY7JesIOuwmO2ZmFxyXG4gICAgICBjb25zdCBzZXNzaW9uID0gc2Vzc2lvbkRhdGFbMF07XHJcbiAgICAgIGNvbnN0IGZha2VDaHVuazogQ2hhdENodW5rID0ge1xyXG4gICAgICAgIGlkOiAnbWV0YS1xdWVzdGlvbi1jaHVuaycsXHJcbiAgICAgICAgY2hhdF9zZXNzaW9uX2lkOiBzZXNzaW9uLmlkLFxyXG4gICAgICAgIGNodW5rX2luZGV4OiAwLFxyXG4gICAgICAgIGNvbnRlbnQ6IGBb7JqU7JW9XTogJHtzZXNzaW9uLnN1bW1hcnl9YCxcclxuICAgICAgICBzaW1pbGFyaXR5OiAxLjBcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBbZmFrZUNodW5rXTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coYOqygOyDiSDsv7zrpqw6IFwiJHtxdWVyeX1cIiwg7Jyg7IKs64+EIOyehOqzhOqwkjogJHtzaW1pbGFyaXR5fSwg7KCc7ZWcOiAke2xpbWl0fWApO1xyXG4gICAgXHJcbiAgICAvLyDsv7zrpqwg7YWN7Iqk7Yq4IOygleygnFxyXG4gICAgY29uc3Qgc2FuaXRpemVkUXVlcnkgPSBzYW5pdGl6ZUpzb25EYXRhKHF1ZXJ5KTtcclxuICAgIGNvbnNvbGUubG9nKGDsoJXsoJzrkJwg7L+866asOiBcIiR7c2FuaXRpemVkUXVlcnl9XCJgKTtcclxuICAgIFxyXG4gICAgaWYgKCFzYW5pdGl6ZWRRdWVyeSB8fCBzYW5pdGl6ZWRRdWVyeS50cmltKCkubGVuZ3RoIDwgMikge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ+y/vOumrOqwgCDrhIjrrLQg7Ken6rGw64KYIOu5hOyWtCDsnojsirXri4jri6QnKTtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDsv7zrpqwg7YWN7Iqk7Yq4IOyehOuyoOuUqSDsg53shLFcclxuICAgIGNvbnN0IHF1ZXJ5RW1iZWRkaW5nID0gYXdhaXQgZ2V0RW1iZWRkaW5nKHNhbml0aXplZFF1ZXJ5KTtcclxuICAgIGNvbnNvbGUubG9nKGDsnoTrsqDrlKkg7IOd7ISxIOyZhOujjDogJHtxdWVyeUVtYmVkZGluZy5sZW5ndGh9IOywqOybkGApO1xyXG4gICAgXHJcbiAgICAvLyDsnKDsgqztlZwg7LKt7YGsIOqygOyDiVxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UucnBjKFxyXG4gICAgICAnbWF0Y2hfY2h1bmtzJyxcclxuICAgICAge1xyXG4gICAgICAgIHF1ZXJ5X2VtYmVkZGluZzogcXVlcnlFbWJlZGRpbmcsXHJcbiAgICAgICAgbWF0Y2hfdGhyZXNob2xkOiBzaW1pbGFyaXR5LFxyXG4gICAgICAgIG1hdGNoX2NvdW50OiBsaW1pdFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign7Jyg7IKsIOyyre2BrCDqsoDsg4kg7Jik66WYOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKGDqsoDsg4nrkJwg7LKt7YGsIOyImDogJHtkYXRhPy5sZW5ndGggfHwgMH1gKTtcclxuICAgIFxyXG4gICAgLy8g6rKA7IOJIOqysOqzvOqwgCDsl4bripQg6rK97JqwIOycoOyCrOuPhCDsnoTqs4TqsJLsnYQg64Ku7Law7IScIOuLpOyLnCDsi5zrj4QgKDLri6jqs4TroZwg64Ku7LakKVxyXG4gICAgaWYgKCFkYXRhIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIC8vIOyyqyDrsojsp7gg7J6s7Iuc64+EOiDsnoTqs4TqsJLsnYQgNTAlIOuCruy2pFxyXG4gICAgICBjb25zdCBsb3dlclRocmVzaG9sZCA9IHNpbWlsYXJpdHkgKiAwLjU7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDqsrDqs7zqsIAg7JeG7Ja0IOycoOyCrOuPhCDsnoTqs4TqsJLsnYQgJHtsb3dlclRocmVzaG9sZC50b0ZpeGVkKDIpfeuhnCDrgq7strAg7J6s7Iuc64+EYCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGRhdGE6IHJldHJ5RGF0YSwgZXJyb3I6IHJldHJ5RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYyhcclxuICAgICAgICAnbWF0Y2hfY2h1bmtzJyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBxdWVyeV9lbWJlZGRpbmc6IHF1ZXJ5RW1iZWRkaW5nLFxyXG4gICAgICAgICAgbWF0Y2hfdGhyZXNob2xkOiBsb3dlclRocmVzaG9sZCxcclxuICAgICAgICAgIG1hdGNoX2NvdW50OiBsaW1pdFxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXRyeUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign64Ku7J2AIOyehOqzhOqwkuycvOuhnCDsnqzsi5zrj4Qg7KSRIOyYpOulmDonLCByZXRyeUVycm9yKTtcclxuICAgICAgfSBlbHNlIGlmIChyZXRyeURhdGEgJiYgcmV0cnlEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhg64Ku7J2AIOyehOqzhOqwkuycvOuhnCAke3JldHJ5RGF0YS5sZW5ndGh96rCcIOyyre2BrCDqsoDsg4nrkKhgKTtcclxuICAgICAgICByZXR1cm4gcmV0cnlEYXRhO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOuRkCDrsojsp7gg7J6s7Iuc64+EOiDrp6TsmrAg64Ku7J2AIOyehOqzhOqwkiAoMC4xKeycvOuhnCDsi5zrj4RcclxuICAgICAgICBjb25zdCBsb3dlc3RUaHJlc2hvbGQgPSAwLjE7XHJcbiAgICAgICAgY29uc29sZS5sb2coYOqysOqzvOqwgCDsl6zsoITtnogg7JeG7Ja0IOy1nOyggCDsnoTqs4TqsJIgJHtsb3dlc3RUaHJlc2hvbGQudG9GaXhlZCgyKX3roZwg7J6s7Iuc64+EYCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBsYXN0UmV0cnlEYXRhLCBlcnJvcjogbGFzdFJldHJ5RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYyhcclxuICAgICAgICAgICdtYXRjaF9jaHVua3MnLFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBxdWVyeV9lbWJlZGRpbmc6IHF1ZXJ5RW1iZWRkaW5nLFxyXG4gICAgICAgICAgICBtYXRjaF90aHJlc2hvbGQ6IGxvd2VzdFRocmVzaG9sZCxcclxuICAgICAgICAgICAgbWF0Y2hfY291bnQ6IGxpbWl0XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAobGFzdFJldHJ5RXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+y1nOyggCDsnoTqs4TqsJLsnLzroZwg7J6s7Iuc64+EIOykkSDsmKTrpZg6JywgbGFzdFJldHJ5RXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobGFzdFJldHJ5RGF0YSAmJiBsYXN0UmV0cnlEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGDstZzsoIAg7J6E6rOE6rCS7Jy866GcICR7bGFzdFJldHJ5RGF0YS5sZW5ndGh96rCcIOyyre2BrCDqsoDsg4nrkKhgKTtcclxuICAgICAgICAgIHJldHVybiBsYXN0UmV0cnlEYXRhO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZGF0YSB8fCBbXTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign7Jyg7IKsIOyyre2BrCDqsoDsg4kg7KSRIOyYpOulmDonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDshLjshZggSUTroZwg64yA7ZmUIOyEuOyFmOydhCDsobDtmoztlanri4jri6QuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdFNlc3Npb25CeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPENoYXRTZXNzaW9uPiB7XHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdjaGF0X3Nlc3Npb25zJylcclxuICAgIC5zZWxlY3QoJyonKVxyXG4gICAgLmVxKCdpZCcsIGlkKVxyXG4gICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICBcclxuICByZXR1cm4gZGF0YTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOuqqOuToCDrjIDtmZQg7IS47IWY7J2EIOyhsO2ajO2VqeuLiOuLpC5cclxuICog7JqU7JW9IOygleuztOunjCDrsJjtmZjtlanri4jri6QgKOyghOyytCDrqZTsi5zsp4DripQg7KCc7Jm4KS5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxDaGF0U2Vzc2lvbnMoKTogUHJvbWlzZTxQYXJ0aWFsPENoYXRTZXNzaW9uPltdPiB7XHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdjaGF0X3Nlc3Npb25zJylcclxuICAgIC5zZWxlY3QoJ2lkLCB0aXRsZSwgdXJsLCBzdW1tYXJ5LCBjcmVhdGVkX2F0LCBtZXRhZGF0YScpXHJcbiAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcbiAgICBcclxuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gIFxyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICog64yA7ZmUIOyEuOyFmOydmCDrqqjrk6Ag7LKt7YGs66W8IOqwgOyguOyYteuLiOuLpC5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDaHVua3NCeVNlc3Npb25JZChzZXNzaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8Q2hhdENodW5rW10+IHtcclxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oJ2NoYXRfY2h1bmtzJylcclxuICAgIC5zZWxlY3QoJyonKVxyXG4gICAgLmVxKCdjaGF0X3Nlc3Npb25faWQnLCBzZXNzaW9uSWQpXHJcbiAgICAub3JkZXIoJ2NodW5rX2luZGV4JywgeyBhc2NlbmRpbmc6IHRydWUgfSk7XHJcbiAgICBcclxuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gIFxyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICog7YKk7JuM65Oc66GcIOuMgO2ZlCDshLjshZjsnYQg6rKA7IOJ7ZWp64uI64ukLlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaENoYXRTZXNzaW9ucyhrZXl3b3JkOiBzdHJpbmcpOiBQcm9taXNlPFBhcnRpYWw8Q2hhdFNlc3Npb24+W10+IHtcclxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oJ2NoYXRfc2Vzc2lvbnMnKVxyXG4gICAgLnNlbGVjdCgnaWQsIHRpdGxlLCB1cmwsIHN1bW1hcnksIGNyZWF0ZWRfYXQsIG1ldGFkYXRhJylcclxuICAgIC5vcihgdGl0bGUuaWxpa2UuJSR7a2V5d29yZH0lLHN1bW1hcnkuaWxpa2UuJSR7a2V5d29yZH0lYClcclxuICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuICAgIFxyXG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgXHJcbiAgcmV0dXJuIGRhdGE7XHJcbn0gIl0sIm5hbWVzIjpbInN1cGFiYXNlQWRtaW4iLCJnZXRFbWJlZGRpbmciLCJjaHVua01lc3NhZ2VzIiwic3VwYWJhc2UiLCJzYW5pdGl6ZUpzb25EYXRhIiwiZGF0YSIsInJlcGxhY2UiLCJtYXRjaCIsInRyaW0iLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJpdGVtIiwic2FuaXRpemVkIiwia2V5IiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiY2hlY2tVcmxFeGlzdHMiLCJ1cmwiLCJub3JtYWxpemVkVXJsIiwiVVJMIiwib3JpZ2luIiwicGF0aG5hbWUiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJpbGlrZSIsImxpbWl0IiwiY29uc29sZSIsImxlbmd0aCIsImV4aXN0cyIsInNlc3Npb24iLCJpbnNlcnRDaGF0U2Vzc2lvbiIsInRpdGxlIiwic3VtbWFyeSIsIm1lc3NhZ2VzIiwibWV0YWRhdGEiLCJza2lwRHVwbGljYXRlQ2hlY2siLCJsb2ciLCJpZCIsImR1cGxpY2F0ZSIsIm1lc3NhZ2UiLCJzYW5pdGl6ZWRUaXRsZSIsInNhbml0aXplZFN1bW1hcnkiLCJzYW5pdGl6ZWRNZXNzYWdlcyIsInNhbml0aXplZE1ldGFkYXRhIiwiZW1iZWRkaW5nIiwiaW5zZXJ0Iiwic2luZ2xlIiwicHJvY2Vzc0FuZEluc2VydENodW5rcyIsInNlc3Npb25JZCIsImNodW5rcyIsImNodW5rUHJvbWlzZXMiLCJjaHVuayIsInNhbml0aXplZENvbnRlbnQiLCJjb250ZW50IiwiY2hhdF9zZXNzaW9uX2lkIiwiY2h1bmtfaW5kZXgiLCJjaHVua3NXaXRoRW1iZWRkaW5ncyIsIlByb21pc2UiLCJhbGwiLCJiYXRjaFNpemUiLCJyZXN1bHRzIiwiaSIsImJhdGNoIiwic2xpY2UiLCJwdXNoIiwic3VjY2VzcyIsImNvdW50Iiwic2VhcmNoU2ltaWxhckNodW5rcyIsInF1ZXJ5Iiwic2ltaWxhcml0eSIsIm1ldGFRdWVzdGlvblBhdHRlcm5zIiwiaXNNZXRhUXVlc3Rpb24iLCJzb21lIiwicGF0dGVybiIsInRlc3QiLCJzZXNzaW9uRGF0YSIsInNlc3Npb25FcnJvciIsIm9yZGVyIiwiYXNjZW5kaW5nIiwid2FybiIsImZha2VDaHVuayIsInNhbml0aXplZFF1ZXJ5IiwicXVlcnlFbWJlZGRpbmciLCJycGMiLCJxdWVyeV9lbWJlZGRpbmciLCJtYXRjaF90aHJlc2hvbGQiLCJtYXRjaF9jb3VudCIsImxvd2VyVGhyZXNob2xkIiwidG9GaXhlZCIsInJldHJ5RGF0YSIsInJldHJ5RXJyb3IiLCJsb3dlc3RUaHJlc2hvbGQiLCJsYXN0UmV0cnlEYXRhIiwibGFzdFJldHJ5RXJyb3IiLCJnZXRDaGF0U2Vzc2lvbkJ5SWQiLCJlcSIsImdldEFsbENoYXRTZXNzaW9ucyIsImdldENodW5rc0J5U2Vzc2lvbklkIiwic2VhcmNoQ2hhdFNlc3Npb25zIiwia2V5d29yZCIsIm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/utils/supabaseHandler.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/gpt-tokenizer","vendor-chunks/@supabase","vendor-chunks/openai","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/event-target-shim","vendor-chunks/agentkeepalive","vendor-chunks/form-data-encoder","vendor-chunks/webidl-conversions","vendor-chunks/abort-controller","vendor-chunks/ms","vendor-chunks/humanize-ms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frag%2Fask%2Froute&page=%2Fapi%2Frag%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frag%2Fask%2Froute.ts&appDir=C%3A%5CpmkProject%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CpmkProject&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();